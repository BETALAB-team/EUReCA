<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>eureca_building.thermal_zone &mdash; EUReCA 0.2 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            EUReCA
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">eureca-ubem</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">EUReCA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">eureca_building.thermal_zone</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for eureca_building.thermal_zone</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module includes functions to model the thermal zone</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Enrico Prataviera&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Enrico Prataviera&quot;</span><span class="p">]</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s2">&quot;Enrico Prataviera&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>

<span class="c1">#import matplotlib.pyplot as plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># import pandas as pd</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>

<span class="kn">from</span> <span class="nn">eureca_building.config</span> <span class="kn">import</span> <span class="n">CONFIG</span>
<span class="kn">from</span> <span class="nn">eureca_building.surface</span> <span class="kn">import</span> <span class="n">Surface</span><span class="p">,</span> <span class="n">SurfaceInternalMass</span>
<span class="kn">from</span> <span class="nn">eureca_building.fluids_properties</span> <span class="kn">import</span> <span class="n">air_properties</span><span class="p">,</span> <span class="n">vapour_properties</span>
<span class="kn">from</span> <span class="nn">eureca_building._VDI6007_auxiliary_functions</span> <span class="kn">import</span> <span class="n">impedence_parallel</span><span class="p">,</span> <span class="n">tri2star</span><span class="p">,</span> <span class="n">long_wave_radiation</span><span class="p">,</span> <span class="n">loadHK</span>
<span class="kn">from</span> <span class="nn">eureca_building.internal_load</span> <span class="kn">import</span> <span class="n">Lights</span><span class="p">,</span> <span class="n">ElectricLoad</span><span class="p">,</span> <span class="n">People</span><span class="p">,</span> <span class="n">InternalLoad</span>
<span class="kn">from</span> <span class="nn">eureca_building.ventilation</span> <span class="kn">import</span> <span class="n">NaturalVentilation</span><span class="p">,</span> <span class="n">Infiltration</span>
<span class="kn">from</span> <span class="nn">eureca_building.air_handling_unit</span> <span class="kn">import</span> <span class="n">AirHandlingUnit</span>
<span class="kn">from</span> <span class="nn">eureca_building.domestic_hot_water</span> <span class="kn">import</span> <span class="n">DomesticHotWater</span>
<span class="kn">from</span> <span class="nn">eureca_building.weather</span> <span class="kn">import</span> <span class="n">WeatherFile</span>
<span class="kn">from</span> <span class="nn">eureca_building.setpoints</span> <span class="kn">import</span> <span class="n">Setpoint</span>
<span class="kn">from</span> <span class="nn">eureca_building.exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Non3ComponentsVertex</span><span class="p">,</span>
    <span class="n">SurfaceWrongNumberOfVertices</span><span class="p">,</span>
    <span class="n">WindowToWallRatioOutsideBoundaries</span><span class="p">,</span>
    <span class="n">InvalidSurfaceType</span><span class="p">,</span>
    <span class="n">NonPlanarSurface</span><span class="p">,</span>
    <span class="n">NegativeSurfaceArea</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># %% ThermalZone class</span>


<div class="viewcode-block" id="ThermalZone"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone">[docs]</a><span class="k">class</span> <span class="nc">ThermalZone</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Thermal zone class. Manages all the models and time step solution of the sensible and latent systems</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">surface_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">net_floor_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">number_of_units</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Int method. Creates the thermal zone object from a list of eureca_building.surface.Surface.</span>
<span class="sd">        Checks the inputs through properties</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the zone</span>
<span class="sd">        surface_list : list</span>
<span class="sd">            list of eureca_building.surface.Surface or eureca_building.surface.SurfaceInternalMass objects</span>
<span class="sd">        net_floor_area : float, default None</span>
<span class="sd">            footprint area of the zone in m2. If None searches for a GroundFloor surface</span>
<span class="sd">        volume : float, default None</span>
<span class="sd">            volume of the zone in m3. If None sets 0 m3.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_surface_list</span> <span class="o">=</span> <span class="n">surface_list</span>
        <span class="k">if</span> <span class="n">volume</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, the volume is not set. Initialized with 0 m3&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_volume</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_volume</span> <span class="o">=</span> <span class="n">volume</span>
        <span class="k">if</span> <span class="n">net_floor_area</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">floors_area</span> <span class="o">=</span> <span class="p">[</span><span class="n">surf</span><span class="o">.</span><span class="n">_area</span> <span class="k">for</span> <span class="n">surf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surface_list</span> <span class="k">if</span>
                           <span class="n">surf</span><span class="o">.</span><span class="n">_surface_type</span> <span class="o">==</span> <span class="s1">&#39;GroundFloor&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">floors_area</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, the footprint area is not set. Initialized with 0 m2&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_net_floor_area</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_net_floor_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">floors_area</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_net_floor_area</span> <span class="o">=</span> <span class="n">net_floor_area</span>

        <span class="c1"># Number of unit/dwelling in the thermal zone (for DHW)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_units</span> <span class="o">=</span> <span class="n">number_of_units</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">internal_loads_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">natural_ventilation_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domestic_hot_water_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">design_heating_system_power</span> <span class="o">=</span> <span class="mf">1e20</span>  <span class="c1"># W</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">design_cooling_system_power</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e20</span>  <span class="c1"># W</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heating_sigma</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;1C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
            <span class="s1">&#39;2C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
        <span class="p">}</span> <span class="c1"># Default convective load</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooling_sigma</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;1C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
            <span class="s1">&#39;2C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
        <span class="p">}</span>  <span class="c1"># Default convective load</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_init_values</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_surface_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__surface_list</span>

    <span class="nd">@_surface_list</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_surface_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, the surface_list must be a list or a tuple: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">Surface</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">SurfaceInternalMass</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, non SUrface object in surface_list. &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__surface_list</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_net_floor_area</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__net_floor_area</span>

    <span class="nd">@_net_floor_area</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_net_floor_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, footprint area is not an float: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, negative footprint area: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">. Simulation will continue with absolute value&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__net_floor_area</span> <span class="o">=</span> <span class="mf">1e-5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__net_floor_area</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__volume</span>

    <span class="nd">@_volume</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, volume is not an float: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, negative volume: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">. Simulation will continue with the absolute value&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__volume</span> <span class="o">=</span> <span class="mf">1e-5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__volume</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_air_thermal_capacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__volume</span> <span class="o">*</span> <span class="n">air_properties</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">air_properties</span><span class="p">[</span><span class="s2">&quot;specific_heat&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">number_of_units</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_units</span>

    <span class="nd">@number_of_units</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">number_of_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, number of units must be an int: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_units</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_air_thermal_capacity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__air_thermal_capacity</span>

    <span class="nd">@_air_thermal_capacity</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_air_thermal_capacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, air thermal capacity is not an float: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, negative air thermal capacity: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">. Simulation will continue with the absolute value&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__air_thermal_capacity</span> <span class="o">=</span> <span class="mf">1e-5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__air_thermal_capacity</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="ThermalZone.add_temperature_setpoint"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.add_temperature_setpoint">[docs]</a>    <span class="k">def</span> <span class="nf">add_temperature_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setpoint</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;air&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to associate a setpoint objects to the thermal zone</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        setpoint : eureca_building.setpoint.Setpoint</span>
<span class="sd">            object of the class Setpoint</span>
<span class="sd">        mode : str</span>
<span class="sd">            setpoint mode: [&#39;air&#39;, &#39;operative&#39;, &#39;radiant&#39;].</span>
<span class="sd">            FOR NOW ONLY AIR IMPLEMENTED</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature_setpoint</span> <span class="o">=</span> <span class="n">setpoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature_setpoint_mode</span> <span class="o">=</span> <span class="n">mode</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">temperature_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_temperature_setpoint</span>

    <span class="nd">@temperature_setpoint</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">temperature_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Setpoint</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Setpoint</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, setpoint must be a Setpoint object&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_temperature_setpoint</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">temperature_setpoint_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_temperature_setpoint_mode</span>

    <span class="nd">@temperature_setpoint_mode</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">temperature_setpoint_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, setpoint mode must be a str&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;air&#39;</span><span class="p">,</span> <span class="s1">&#39;operative&#39;</span><span class="p">,</span> <span class="s1">&#39;radiant&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, setpoint mode must be chosen from &#39;air&#39;, &#39;operative&#39;, &#39;radiant&#39;&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_temperature_setpoint_mode</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="ThermalZone.add_humidity_setpoint"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.add_humidity_setpoint">[docs]</a>    <span class="k">def</span> <span class="nf">add_humidity_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setpoint</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to associate a humidity setpoint to the thermal zone</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        setpoint : eureca_building.setpoint.Setpoint</span>
<span class="sd">            object of the class Setpoint</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">humidity_setpoint</span> <span class="o">=</span> <span class="n">setpoint</span>
        <span class="c1"># the mode is in the SP object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">humidity_setpoint_mode</span> <span class="o">=</span> <span class="n">setpoint</span><span class="o">.</span><span class="n">setpoint_type</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">humidity_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_humidity_setpoint</span>

    <span class="nd">@humidity_setpoint</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">humidity_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Setpoint</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Setpoint</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, setpoint must be a Setpoint object&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_humidity_setpoint</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">humidity_setpoint_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_humidity_setpoint_mode</span>

    <span class="nd">@humidity_setpoint_mode</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">humidity_setpoint_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, setpoint mode must be a str&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;relative_humidity&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, setpoint mode must be chosen from &#39;relative_humidity&#39;&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_humidity_setpoint_mode</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="ThermalZone.get_specific_humidity"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.get_specific_humidity">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_specific_humidity</span><span class="p">(</span><span class="n">air_t</span><span class="p">,</span> <span class="n">air_rh</span><span class="p">,</span> <span class="n">p_atm</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Static method. Give the specific humidity from temperature, relative humidity, and atmospheric pressure</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        air_t : float</span>
<span class="sd">            air temperature [°C]</span>
<span class="sd">        air_rh : float</span>
<span class="sd">            air relative humidity [-]</span>
<span class="sd">        p_atm : float</span>
<span class="sd">            atmospheric pressure [pa]</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        float</span>
<span class="sd">            specific humidity [kg_vap/kg_da]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">air_rh</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;A relative humidity is below zero. Simulation will continue with a minimum of zero&quot;</span><span class="p">)</span>
            <span class="n">air_rh</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="n">air_rh</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;A relative humidity is above one. Simulation will continue with a maximum of one&quot;</span><span class="p">)</span>
            <span class="n">air_rh</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="k">if</span> <span class="n">air_t</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">p_intsat</span> <span class="o">=</span> <span class="mf">610.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mf">21.875</span> <span class="o">*</span> <span class="n">air_t</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">265.5</span> <span class="o">+</span> <span class="n">air_t</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p_intsat</span> <span class="o">=</span> <span class="mf">610.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mf">17.269</span> <span class="o">*</span> <span class="n">air_t</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">237.3</span> <span class="o">+</span> <span class="n">air_t</span><span class="p">))</span>

        <span class="n">x_int</span> <span class="o">=</span> <span class="mf">0.622</span> <span class="o">*</span> <span class="p">(</span><span class="n">air_rh</span> <span class="o">*</span> <span class="n">p_intsat</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_atm</span> <span class="o">-</span> <span class="p">(</span><span class="n">air_rh</span> <span class="o">*</span> <span class="n">p_intsat</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">x_int</span><span class="p">,</span> <span class="n">p_intsat</span></div>

<div class="viewcode-block" id="ThermalZone.add_internal_load"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.add_internal_load">[docs]</a>    <span class="k">def</span> <span class="nf">add_internal_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">internal_load</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to associate a load to the thermal zone</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        internal_load : eureca_building.internal_load.InternalLoad</span>
<span class="sd">            As many eureca_building.internal_load.InternalLoad can be provided</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">int_load</span> <span class="ow">in</span> <span class="n">internal_load</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">int_load</span><span class="p">,</span> <span class="n">InternalLoad</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;ThermalZone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, add_internal_load() method: internal_load not of InternalLoad type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">int_load</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">internal_loads_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">int_load</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThermalZone.extract_convective_radiative_latent_electric_load"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.extract_convective_radiative_latent_electric_load">[docs]</a>    <span class="k">def</span> <span class="nf">extract_convective_radiative_latent_electric_load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;From the internal loads calculates 3 arrays (len equal to 8769 * number of time steps per hour):</span>
<span class="sd">        {</span>
<span class="sd">        convective [W] : np.array</span>
<span class="sd">        radiative [W] : np.array</span>
<span class="sd">        latent [kg_vap/s] : np.array</span>
<span class="sd">        }</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">convective</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">number_of_time_steps_year</span><span class="p">)</span>
        <span class="n">radiant</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">number_of_time_steps_year</span><span class="p">)</span>
        <span class="n">latent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">number_of_time_steps_year</span><span class="p">)</span>
        <span class="n">electric</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">number_of_time_steps_year</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">load</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_loads_list</span><span class="p">:</span>
            <span class="n">load_conv</span><span class="p">,</span> <span class="n">load_rad</span><span class="p">,</span> <span class="n">load_lat</span><span class="p">,</span> <span class="n">load_el</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">get_loads</span><span class="p">(</span><span class="n">area</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_net_floor_area</span><span class="p">)</span>
            <span class="n">convective</span> <span class="o">+=</span> <span class="n">load_conv</span>
            <span class="n">radiant</span> <span class="o">+=</span> <span class="n">load_rad</span>
            <span class="n">latent</span> <span class="o">+=</span> <span class="n">load_lat</span>
            <span class="n">electric</span> <span class="o">+=</span> <span class="n">load_el</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convective_load</span> <span class="o">=</span> <span class="n">convective</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radiative_load</span> <span class="o">=</span> <span class="n">radiant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latent_load</span> <span class="o">=</span> <span class="n">latent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electric_load</span> <span class="o">=</span> <span class="n">electric</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;convective [W]&#39;</span><span class="p">:</span> <span class="n">convective</span><span class="p">,</span>
                <span class="s1">&#39;radiative [W]&#39;</span><span class="p">:</span> <span class="n">radiant</span><span class="p">,</span>
                <span class="s1">&#39;latent [kg_vap/s]&#39;</span><span class="p">:</span> <span class="n">latent</span><span class="p">,</span>
                <span class="s1">&#39;electric [W]&#39;</span><span class="p">:</span> <span class="n">electric</span><span class="p">}</span></div>

<div class="viewcode-block" id="ThermalZone.add_infiltration"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.add_infiltration">[docs]</a>    <span class="k">def</span> <span class="nf">add_infiltration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">infiltration</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to associate a natural ventilation object to the thermal zone</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        natural_ventilation : eureca_building.ventilation.Infiltration</span>
<span class="sd">            As many eureca_building.ventilation.Infiltration can be provided</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">inf</span> <span class="ow">in</span> <span class="n">infiltration</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inf</span><span class="p">,</span> <span class="n">Infiltration</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;ThermalZone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, add_infiltration() method: infiltrion not of Infiltration type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">inf</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inf</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThermalZone.calc_infiltration"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.calc_infiltration">[docs]</a>    <span class="k">def</span> <span class="nf">calc_infiltration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weather</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;From the infiltration_list calculates 2 arrays (len equal to 8769 * number of time steps per hour):</span>
<span class="sd">        {</span>
<span class="sd">        air mass flow rate [kg/s] : np.array</span>
<span class="sd">        vapour mass flow rate [kg/s] : np.array</span>
<span class="sd">        }</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        weather : eureca_building.weather.WeatherFile</span>
<span class="sd">            WeatherFile object</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">infiltration_air_flow_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">number_of_time_steps_year</span><span class="p">)</span>
        <span class="n">infiltration_vapour_flow_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">number_of_time_steps_year</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">inf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_list</span><span class="p">:</span>
            <span class="n">air_rate</span><span class="p">,</span> <span class="n">vapour_rate</span> <span class="o">=</span> <span class="n">inf</span><span class="o">.</span><span class="n">get_flow_rate</span><span class="p">(</span><span class="n">weather</span><span class="p">,</span> <span class="n">area</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_net_floor_area</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_volume</span><span class="p">)</span>
            <span class="n">infiltration_air_flow_rate</span> <span class="o">+=</span> <span class="n">air_rate</span>
            <span class="n">infiltration_vapour_flow_rate</span> <span class="o">+=</span> <span class="n">vapour_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_air_flow_rate</span> <span class="o">=</span> <span class="n">infiltration_air_flow_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_vapour_flow_rate</span> <span class="o">=</span> <span class="n">infiltration_vapour_flow_rate</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;infiltration_air_flow_rate [kg/s]&#39;</span><span class="p">:</span> <span class="n">infiltration_air_flow_rate</span><span class="p">,</span>
                <span class="s1">&#39;infiltration_vapour_flow_rate [kg/s]&#39;</span><span class="p">:</span> <span class="n">infiltration_vapour_flow_rate</span><span class="p">,</span> <span class="p">}</span></div>

<div class="viewcode-block" id="ThermalZone.add_air_handling_unit"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.add_air_handling_unit">[docs]</a>    <span class="k">def</span> <span class="nf">add_air_handling_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ahu</span><span class="p">,</span> <span class="n">weather</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to associate an air_handling_unit object to the thermal zone</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ahu : eureca_building.air_handling_unit.AirHandlingUnit</span>
<span class="sd">            AirHandlingUnit object</span>
<span class="sd">        weather : eureca_building.weather.WeatherFile</span>
<span class="sd">            WeatherFile object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">air_handling_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">ahu</span><span class="p">,</span> <span class="n">weather</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">air_handling_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AirHandlingUnit</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_air_handling_unit</span>

    <span class="nd">@air_handling_unit</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">air_handling_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">AirHandlingUnit</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">AirHandlingUnit</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, air_handling_unit must be a AirHandlingUnit object&quot;</span>
            <span class="p">)</span>
        <span class="n">ahu</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">weather</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_air_handling_unit</span> <span class="o">=</span> <span class="n">ahu</span>

        <span class="c1"># mechanical_ventilation_air_flow_rate = np.zeros(CONFIG.number_of_time_steps_year)</span>
        <span class="c1"># mechanical_ventilation_vapour_flow_rate = np.zeros(CONFIG.number_of_time_steps_year)</span>
        <span class="c1"># air_rate, vapour_rate = self._air_handling_unit.mechanical_ventilation.get_flow_rate(weather, area=self._net_floor_area, volume=self._volume)</span>
        <span class="c1"># mechanical_ventilation_air_flow_rate = air_rate</span>
        <span class="c1"># mechanical_ventilation_vapour_flow_rate = vapour_rate</span>
        <span class="c1"># self.mechanical_ventilation_air_flow_rate = mechanical_ventilation_air_flow_rate</span>
        <span class="c1"># self.mechanical_ventilation_vapour_flow_rate = mechanical_ventilation_vapour_flow_rate</span>

    <span class="c1"># def _plot_Zone_Natural_Ventilation(self, weather_file):</span>
    <span class="c1">#     fig, [ax1, ax2] = plt.subplots(nrows=2)</span>
    <span class="c1">#     ax1_ = ax1.twinx()</span>
    <span class="c1">#     pd.DataFrame({</span>
    <span class="c1">#         &#39;infiltration_air_flow_rate [kg/s]&#39;: self.infiltration_air_flow_rate,</span>
    <span class="c1">#     }).plot(ax=ax1)</span>
    <span class="c1">#     pd.DataFrame({</span>
    <span class="c1">#         &#39;infiltration_vapour_flow_rate [kg/s]&#39;: self.infiltration_vapour_flow_rate,</span>
    <span class="c1">#     }).plot(ax=ax1_, color=&#39;r&#39;)</span>
    <span class="c1">#     pd.DataFrame({</span>
    <span class="c1">#         &#39;oa_specific_humidity&#39;: weather_file.hourly_data[&#39;out_air_specific_humidity&#39;],</span>
    <span class="c1">#         &#39;theta_ext&#39;: weather_file.hourly_data[&#39;out_air_db_temperature&#39;],</span>
    <span class="c1">#         &#39;oa_relative_humidity&#39;: weather_file.hourly_data[&#39;out_air_relative_humidity&#39;]</span>
    <span class="c1">#     }).plot(ax=ax2)</span>

<div class="viewcode-block" id="ThermalZone.add_domestic_hot_water"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.add_domestic_hot_water">[docs]</a>    <span class="k">def</span> <span class="nf">add_domestic_hot_water</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weather_obj</span><span class="p">,</span> <span class="o">*</span><span class="n">dhw_obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to associate a domestic hot water object to the thermal zone</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dhw_obj : eureca_building.domestic_hot_water.DomesticHotWater</span>
<span class="sd">            DomesticHotWater object</span>
<span class="sd">        weather : eureca_building.weather.WeatherFile</span>
<span class="sd">            WeatherFile object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domestic_hot_water_volume_flow_rate</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># m3/s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domestic_hot_water_demand</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># W</span>
        <span class="k">for</span> <span class="n">dhw</span> <span class="ow">in</span> <span class="n">dhw_obj</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dhw</span><span class="p">,</span> <span class="n">DomesticHotWater</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: add_domestic_hot_water input is not a DomesticHotWater object&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">domestic_hot_water_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dhw</span><span class="p">)</span>
            <span class="n">volume</span><span class="p">,</span> <span class="n">demand</span> <span class="o">=</span> <span class="n">dhw</span><span class="o">.</span><span class="n">get_dhw_yearly_mass_flow_rate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_net_floor_area</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_units</span><span class="p">,</span> <span class="n">weather_obj</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">domestic_hot_water_volume_flow_rate</span> <span class="o">+=</span> <span class="n">volume</span>  <span class="c1"># m3/s</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">domestic_hot_water_demand</span> <span class="o">+=</span> <span class="n">demand</span>  <span class="c1"># W</span></div>

    <span class="k">def</span> <span class="nf">_ISO13790_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Calculates the thermal zone parameters of the ISO 13790</span>
<span class="sd">        it does not require input</span>

<span class="sd">        Htr_is</span>
<span class="sd">        Htr_w</span>
<span class="sd">        Htr_ms</span>
<span class="sd">        Htr_emCm</span>
<span class="sd">        DenAm</span>
<span class="sd">        Atot</span>
<span class="sd">        Htr_op</span>
<span class="sd">        UA_tot</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Htr_is</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Htr_w</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Htr_ms</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Htr_em</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cm</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DenAm</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Atot</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Htr_op</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="c1"># list all surface to extract the window and opeque area and other thermo physical prop</span>

        <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surface_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">surface</span><span class="o">.</span><span class="n">surface_type</span> <span class="o">==</span> <span class="s1">&#39;IntFloor&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Cm</span> <span class="o">+=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">k_est</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">DenAm</span> <span class="o">+=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">k_est</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Cm</span> <span class="o">+=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">k_int</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">DenAm</span> <span class="o">+=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">k_int</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Atot</span> <span class="o">+=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_area</span>

                <span class="k">if</span> <span class="n">surface</span><span class="o">.</span><span class="n">surface_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ExtWall&quot;</span><span class="p">,</span> <span class="s2">&quot;GroundFloor&quot;</span><span class="p">,</span> <span class="s2">&quot;Roof&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Htr_op</span> <span class="o">+=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">_u_value</span>
                    <span class="k">if</span> <span class="n">surface</span><span class="o">.</span><span class="n">_glazed_area</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Htr_w</span> <span class="o">+=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_glazed_area</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">_u_value</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, surface </span><span class="si">{</span><span class="n">surface</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> construction or window not specified&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Final calculation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">htr_ms</span> <span class="o">=</span> <span class="mf">9.1</span>  <span class="c1"># heat tranfer coeff. ISO 13790 [W/(m2 K)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_is</span> <span class="o">=</span> <span class="mf">3.45</span>  <span class="c1"># heat tranfer coeff. ISO 13790 [W/(m2 K)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Am</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cm</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">DenAm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Htr_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Am</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">htr_ms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Htr_em</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_op</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_ms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Htr_is</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_is</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Atot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UA_tot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_op</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_w</span>

<div class="viewcode-block" id="ThermalZone.print_ISO13790_params"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.print_ISO13790_params">[docs]</a>    <span class="k">def</span> <span class="nf">print_ISO13790_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Just a beuty print of ISO 13790 parameters</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> 1C params:        </span>
<span class="s2">        Cm: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Cm</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span>
<span class="s2">        Htr_is: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Htr_is</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span>
<span class="s2">        Htr_w: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Htr_w</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span>
<span class="s2">        Htr_ms: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Htr_ms</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span>
<span class="s2">        Htr_em: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Htr_em</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span>
<span class="s2">        Htr_op: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Htr_op</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span></div>

    <span class="k">def</span> <span class="nf">_VDI6007_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Calculates the thermal zone parameters of the VDI 6007</span>
<span class="sd">        it does not require input</span>

<span class="sd">        Araum_tot</span>
<span class="sd">        Aaw_tot</span>
<span class="sd">        Araum_opaque</span>
<span class="sd">        Aaw_opaque</span>
<span class="sd">        R1AW, R1IW, C1AW, C1IW</span>
<span class="sd">        RgesAW</span>
<span class="sd">        RrestAW</span>
<span class="sd">        RalphaStarIL, RalphaStarAW, RalphaStarIW</span>
<span class="sd">        UA_tot</span>
<span class="sd">        Htr_op</span>
<span class="sd">        Htr_w</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Creation of some arrys of variables and parameters</span>

        <span class="n">alphaStr</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># vdi Value</span>
        <span class="n">alphaKonA</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># vdi Value</span>
        <span class="n">R1IW_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">C1IW_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">R_IW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">R1AW_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">C1AW_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">R_AW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">R1_AF_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">HAW_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">HAF_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">alphaKonAW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">alphaKonIW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">alphaKonAF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">RalphaStrAW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">RalphaStrIW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">RalphaStrAF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">AreaAW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">AreaAF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">AreaIW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Araum_tot</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Aaw_tot</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Araum_opaque</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Aaw_opaque</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Cycling surface to calculates the Resistance and capacitance of the vdi 6007</span>

        <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surface_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Araum_tot</span> <span class="o">+=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_area</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Araum_opaque</span> <span class="o">+=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span>
            <span class="k">if</span> <span class="n">surface</span><span class="o">.</span><span class="n">surface_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ExtWall&quot;</span><span class="p">,</span> <span class="s2">&quot;GroundFloor&quot;</span><span class="p">,</span> <span class="s2">&quot;Roof&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Aaw_tot</span> <span class="o">+=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_area</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Aaw_opaque</span> <span class="o">+=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span>
                <span class="n">surface_R1</span><span class="p">,</span> <span class="n">surface_C1</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">get_VDI6007_surface_params</span><span class="p">(</span><span class="n">asim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">C1AW_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C1AW_v</span><span class="p">,</span> <span class="p">[</span><span class="n">surface_C1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># Opaque params</span>
                <span class="n">HAW_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HAW_v</span><span class="p">,</span> <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">_u_value</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span><span class="p">)</span>
                <span class="n">alphaKonAW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alphaKonAW</span><span class="p">,</span>
                                       <span class="p">[</span><span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span> <span class="o">*</span> <span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">_conv_heat_trans_coef_int</span><span class="p">)],</span>
                                       <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">RalphaStrAW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RalphaStrAW</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">rad_heat_trans_coef</span><span class="p">)])</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Glazed params</span>
                    <span class="n">R_AF_v</span> <span class="o">=</span> <span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">Rl_w</span> <span class="o">/</span> <span class="n">surface</span><span class="o">.</span><span class="n">_glazed_area</span><span class="p">)</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">_glazed_area</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-5</span> <span class="k">else</span> <span class="mf">1e15</span>
                    <span class="c1"># Eq 26</span>
                    <span class="n">HAF_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HAF_v</span><span class="p">,</span> <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">_u_value</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">_glazed_area</span><span class="p">)</span>
                    <span class="n">alphaKonAF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alphaKonAF</span><span class="p">,</span>
                                           <span class="p">[</span><span class="n">surface</span><span class="o">.</span><span class="n">_glazed_area</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">Ri_w</span> <span class="o">-</span> <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">rad_heat_trans_coef</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">RalphaStrAF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RalphaStrAF</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">_glazed_area</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">rad_heat_trans_coef</span><span class="p">)])</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ZeroDivisionError</span><span class="p">):</span>
                    <span class="c1"># case of no glazed area</span>
                    <span class="n">R_AF_v</span> <span class="o">=</span> <span class="mf">1e15</span>
                    <span class="n">HAF_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HAF_v</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
                    <span class="n">alphaKonAF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alphaKonAF</span><span class="p">,</span>
                                           <span class="p">[</span><span class="mf">0.</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">RalphaStrAF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RalphaStrAF</span><span class="p">,</span> <span class="p">[</span><span class="mf">1e15</span><span class="p">])</span>
                <span class="c1"># this part is a little different in Jacopo model,</span>
                <span class="c1"># However this part calculates opaque R, glazed R and insert the parallel as wall R</span>
                <span class="c1"># R1AW_v = np.append(R1AW_v, [1 / (1 / surface_R1 + 1 / R_AF_v)], axis=0)</span>
                <span class="n">R1AW_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R1AW_v</span><span class="p">,[</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">surface_R1</span><span class="o">+</span><span class="mi">6</span><span class="o">/</span><span class="n">R_AF_v</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># ALTERNATIVA NORMA</span>

                <span class="n">AreaAW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AreaAW</span><span class="p">,</span> <span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span><span class="p">)</span>
                <span class="n">AreaAF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AreaAF</span><span class="p">,</span> <span class="n">surface</span><span class="o">.</span><span class="n">_glazed_area</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">surface</span><span class="o">.</span><span class="n">surface_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;IntWall&quot;</span><span class="p">,</span> <span class="s2">&quot;IntCeiling&quot;</span><span class="p">,</span> <span class="s2">&quot;IntFloor&quot;</span><span class="p">]:</span>
                <span class="n">surface_R1</span><span class="p">,</span> <span class="n">surface_C1</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">get_VDI6007_surface_params</span><span class="p">(</span><span class="n">asim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">R1IW_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R1IW_m</span><span class="p">,</span> <span class="p">[</span><span class="n">surface_R1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">C1IW_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C1IW_m</span><span class="p">,</span> <span class="p">[</span><span class="n">surface_C1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">R_IW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R_IW</span><span class="p">,</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">thermal_resistances</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">alphaKonIW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alphaKonIW</span><span class="p">,</span>
                                       <span class="p">[</span><span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span> <span class="o">*</span> <span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">_conv_heat_trans_coef_int</span><span class="p">)],</span>
                                       <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1"># if surface.opaqueArea*alphaStr == 0:</span>
                <span class="c1">#    print(surface.name)</span>
                <span class="n">RalphaStrIW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RalphaStrIW</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">rad_heat_trans_coef</span><span class="p">)])</span>

                <span class="n">AreaIW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AreaIW</span><span class="p">,</span> <span class="n">surface</span><span class="o">.</span><span class="n">_area</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Surface </span><span class="si">{</span><span class="n">surface</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">: surface type not found: </span><span class="si">{</span><span class="n">surface</span><span class="o">.</span><span class="n">surface_type</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>

        <span class="c1"># Doing the parallel of the impedances</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">R1AW</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1AW</span> <span class="o">=</span> <span class="n">impedence_parallel</span><span class="p">(</span><span class="n">R1AW_v</span><span class="p">,</span> <span class="n">C1AW_v</span><span class="p">)</span>  <span class="c1"># eq 22</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R1IW</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1IW</span> <span class="o">=</span> <span class="n">impedence_parallel</span><span class="p">(</span><span class="n">R1IW_m</span><span class="p">,</span> <span class="n">C1IW_m</span><span class="p">)</span>

        <span class="c1"># Final params</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">RgesAW</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">HAW_v</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">HAF_v</span><span class="p">))</span>  <span class="c1"># eq 27</span>

        <span class="n">RalphaKonAW</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">alphaKonAW</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">alphaKonAF</span><span class="p">))</span>  <span class="c1"># scalar</span>
        <span class="n">RalphaKonIW</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">alphaKonIW</span><span class="p">)</span>  <span class="c1"># scalar</span>

        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">AreaAW</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">AreaIW</span><span class="p">):</span>
            <span class="n">RalphaStrAWIW</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">RalphaStrAW</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">RalphaStrAF</span><span class="p">))</span>  <span class="c1"># eq 29</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">RalphaStrAWIW</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">RalphaStrIW</span><span class="p">)</span>  <span class="c1"># eq 31</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">RrestAW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RgesAW</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1AW</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">RalphaKonAW</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">RalphaStrAWIW</span><span class="p">)</span>  <span class="c1"># eq 28</span>

        <span class="n">RalphaGesAW_A</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">alphaKonA</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">AreaAF</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">AreaAW</span><span class="p">)))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">RgesAW</span> <span class="o">&lt;</span> <span class="n">RalphaGesAW_A</span><span class="p">:</span>  <span class="c1"># this is different from Jacopo&#39;s model but equal to the standard</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RrestAW</span> <span class="o">=</span> <span class="n">RalphaGesAW_A</span>  <span class="c1"># eq 28a</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">R1AW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RgesAW</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">RrestAW</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">RalphaKonAW</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">RalphaStrAWIW</span><span class="p">)</span>  <span class="c1"># eq 28b</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1AW</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">R1AW</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Thresold (only numerical to avoid division by zero)  #eq 28c</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarAW</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIW</span> <span class="o">=</span> <span class="n">tri2star</span><span class="p">(</span><span class="n">RalphaStrAWIW</span><span class="p">,</span> <span class="n">RalphaKonIW</span><span class="p">,</span> <span class="n">RalphaKonAW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UA_tot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">HAW_v</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">HAF_v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Htr_op</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">HAW_v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Htr_w</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">HAF_v</span><span class="p">)</span>

<div class="viewcode-block" id="ThermalZone.print_VDI6007_params"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.print_VDI6007_params">[docs]</a>    <span class="k">def</span> <span class="nf">print_VDI6007_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Just a beuty print of VDI6007 parameters</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> 2C params:        </span>
<span class="s2">        R1AW: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">R1AW</span><span class="si">:</span><span class="s2">.10f</span><span class="si">}</span>
<span class="s2">        R1IW: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">R1IW</span><span class="si">:</span><span class="s2">.10f</span><span class="si">}</span><span class="s2">   </span>
<span class="s2">        C1AW: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">C1AW</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span>
<span class="s2">        C1IW: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">C1IW</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span>
<span class="s2">        RrestAW: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">RrestAW</span><span class="si">:</span><span class="s2">.10f</span><span class="si">}</span>
<span class="s2">        RalphaStarIL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIL</span><span class="si">:</span><span class="s2">.10f</span><span class="si">}</span>
<span class="s2">        RalphaStarAW: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarAW</span><span class="si">:</span><span class="s2">.10f</span><span class="si">}</span>
<span class="s2">        RalphaStarIW: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIW</span><span class="si">:</span><span class="s2">.10f</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="ThermalZone.calculate_zone_loads_ISO13790"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.calculate_zone_loads_ISO13790">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_zone_loads_ISO13790</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weather</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Calculates the heat gains (internal and solar) on the three nodes of the ISO 13790 network</span>
<span class="sd">        Vectorial calculation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        weather : eureca_building.weather.WeatherFile</span>
<span class="sd">            WeatherFile object</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Check input data type</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weather</span><span class="p">,</span> <span class="n">WeatherFile</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ThermalZone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">, weather type is not a WeatherFile: weather type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># Check input data quality</span>
        <span class="c1"># First calculation of internal heat gains</span>

        <span class="n">phi_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_convective_radiative_latent_electric_load</span><span class="p">()</span>
        <span class="n">phi_sol_gl_tot</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">phi_sol_op_tot</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Solar radiation</span>
        <span class="n">irradiances</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="n">hourly_data_irradiances</span>

        <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surface_list</span><span class="p">:</span>

            <span class="n">phi_sol_op</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">phi_sol_gl</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">surface</span><span class="o">.</span><span class="n">surface_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ExtWall&#39;</span><span class="p">,</span> <span class="s1">&#39;Roof&#39;</span><span class="p">]:</span>
                <span class="n">F_sh_urban_shading</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">shading_coefficient</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="s2">&quot;shading_coefficient&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mf">1.</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="s1">&#39;window&#39;</span><span class="p">):</span>
                    <span class="n">h_r</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">get_surface_external_radiative_coefficient</span><span class="p">()</span>

                    <span class="n">irradiance</span> <span class="o">=</span> <span class="n">irradiances</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">_azimuth_round</span><span class="p">)][</span><span class="nb">float</span><span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">_height_round</span><span class="p">)]</span>
                    <span class="n">BRV</span> <span class="o">=</span> <span class="n">irradiance</span><span class="p">[</span><span class="s1">&#39;direct&#39;</span><span class="p">]</span>
                    <span class="n">TRV</span> <span class="o">=</span> <span class="n">irradiance</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span>
                    <span class="n">DRV</span> <span class="o">=</span> <span class="n">TRV</span> <span class="o">-</span> <span class="n">BRV</span>
                    <span class="n">A_ww</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_glazed_area</span>
                    <span class="n">A_op</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span>

                    <span class="c1"># Glazed surfaces</span>
                    <span class="n">F_sh_w</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">_shading_coef_ext</span>
                    <span class="n">F_w</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">_shading_coef_int</span>
                    <span class="n">F_f</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">_frame_factor</span>
                    <span class="n">AOI</span> <span class="o">=</span> <span class="n">irradiance</span><span class="p">[</span><span class="s1">&#39;AOI&#39;</span><span class="p">]</span>
                    <span class="n">shgc</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splev</span><span class="p">(</span><span class="n">AOI</span><span class="p">,</span> <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">solar_heat_gain_coef_profile</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">shgc_diffuse</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splev</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">solar_heat_gain_coef_profile</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="c1"># if i.OnOff_shading == &#39;On&#39;:</span>
                    <span class="c1">#     phi_sol_gl = F_so * (BRV * F_sh * F_w * (</span>
                    <span class="c1">#             1 - F_f) * shgc * A_ww * i.shading_effect) + F_so * DRV * F_sh * F_w * (</span>
                    <span class="c1">#                          1 - F_f) * shgc_diffuse * A_ww</span>
                    <span class="c1"># else:</span>
                    <span class="n">phi_sol_gl</span> <span class="o">=</span> <span class="n">F_sh_urban_shading</span> <span class="o">*</span> <span class="n">BRV</span> <span class="o">*</span> <span class="n">F_sh_w</span> <span class="o">*</span> <span class="n">F_w</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">F_f</span><span class="p">)</span> <span class="o">*</span> <span class="n">shgc</span> <span class="o">*</span> <span class="n">A_ww</span> \
                                 <span class="o">+</span> <span class="n">DRV</span> <span class="o">*</span> <span class="n">F_sh_w</span> <span class="o">*</span> <span class="n">F_w</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">F_f</span><span class="p">)</span> <span class="o">*</span> <span class="n">shgc_diffuse</span> <span class="o">*</span> <span class="n">A_ww</span>

                <span class="c1"># Opaque surfaces</span>
                <span class="n">F_r</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_sky_view_factor</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_construction</span><span class="o">.</span><span class="n">ext_absorptance</span>
                <span class="n">sr</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_construction</span><span class="o">.</span><span class="n">_R_se</span>
                <span class="n">U_net</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_construction</span><span class="o">.</span><span class="n">_u_value_net</span>
                <span class="c1"># if i.OnOff_shading == &#39;On&#39;:</span>
                <span class="c1">#     phi_sol_op = F_sh * (</span>
                <span class="c1">#             BRV * i.shading_effect + DRV) * self.alpha * self.sr_ew * self.U_ew_net * self.A_ew - self.F_r * self.sr_ew * self.U_ew_net * self.A_ew * h_r * weather.dT_er</span>
                <span class="c1"># else:</span>
                <span class="n">phi_sol_op</span> <span class="o">=</span> <span class="n">F_sh_urban_shading</span> <span class="o">*</span> <span class="n">TRV</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">sr</span> <span class="o">*</span> <span class="n">U_net</span> <span class="o">*</span> <span class="n">A_op</span> <span class="o">-</span> \
                             <span class="n">F_r</span> <span class="o">*</span> <span class="n">sr</span> <span class="o">*</span> <span class="n">U_net</span> <span class="o">*</span> <span class="n">A_op</span> <span class="o">*</span> <span class="n">h_r</span> <span class="o">*</span> \
                             <span class="n">weather</span><span class="o">.</span><span class="n">general_data</span><span class="p">[</span><span class="s1">&#39;average_dt_air_sky&#39;</span><span class="p">]</span>

            <span class="c1"># Total solar gain</span>
            <span class="n">phi_sol_gl_tot</span> <span class="o">+=</span> <span class="n">phi_sol_gl</span>
            <span class="n">phi_sol_op_tot</span> <span class="o">+=</span> <span class="n">phi_sol_op</span>

        <span class="n">phi_sol</span> <span class="o">=</span> <span class="n">phi_sol_gl_tot</span> <span class="o">+</span> <span class="n">phi_sol_op_tot</span>

        <span class="c1"># Distribute heat gains to temperature nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi_ia</span> <span class="o">=</span> <span class="n">phi_int</span><span class="p">[</span><span class="s1">&#39;convective [W]&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi_st</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Am</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Atot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_w</span> <span class="o">/</span> <span class="p">(</span><span class="mf">9.1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Atot</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi_int</span><span class="p">[</span><span class="s1">&#39;radiative [W]&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">phi_sol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Am</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Atot</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi_int</span><span class="p">[</span><span class="s1">&#39;radiative [W]&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">phi_sol</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThermalZone.calculate_zone_loads_VDI6007"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.calculate_zone_loads_VDI6007">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_zone_loads_VDI6007</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weather</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Calculates zone loads for the vdi 6007 standard</span>
<span class="sd">        Also the external equivalent temperature</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        weather : eureca_building.weather.WeatherFile</span>
<span class="sd">            WeatherFile obj</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Check input data type</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weather</span><span class="p">,</span> <span class="n">WeatherFile</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ThermalZone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">, weather type is not a WeatherFile: weather type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


        <span class="c1"># Eerd = Solar_gain[&#39;0.0&#39;][&#39;0.0&#39;][&#39;Global&#39;]*rho_ground                          #</span>
        <span class="c1"># Eatm = Solar_gain[&#39;0.0&#39;][&#39;0.0&#39;][&#39;Global&#39;]-Solar_gain[&#39;0.0&#39;][&#39;0.0&#39;][&#39;Direct&#39;]</span>
        <span class="c1">#</span>
        <span class="c1"># T_ext vettore</span>


        <span class="n">Eatm</span><span class="p">,</span> <span class="n">Eerd</span><span class="p">,</span> <span class="n">theta_erd</span><span class="p">,</span> <span class="n">theta_atm</span> <span class="o">=</span> <span class="n">long_wave_radiation</span><span class="p">(</span><span class="n">weather</span><span class="o">.</span><span class="n">hourly_data</span><span class="p">[</span><span class="s1">&#39;out_air_db_temperature&#39;</span><span class="p">])</span>

        <span class="n">alpha_str_lw</span> <span class="o">=</span> <span class="p">(</span><span class="n">Eatm</span> <span class="o">+</span> <span class="n">Eerd</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">theta_atm</span> <span class="o">-</span> <span class="n">theta_erd</span><span class="p">)</span>
        <span class="n">alpha_str_lw</span><span class="p">[(</span><span class="n">alpha_str_lw</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">theta_atm</span> <span class="o">-</span> <span class="n">theta_erd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">5.</span>

        <span class="c1"># Creates some vectors and set some parameters</span>

        <span class="n">T_ext</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="n">hourly_data</span><span class="p">[</span><span class="s1">&#39;out_air_db_temperature&#39;</span><span class="p">]</span>
        <span class="n">theta_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">T_ext</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_surface_list</span><span class="p">)])</span>
        <span class="n">delta_theta_eq_lw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">T_ext</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_surface_list</span><span class="p">)])</span>
        <span class="n">delta_theta_eq_kw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">T_ext</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_surface_list</span><span class="p">)])</span>
        <span class="n">theta_eq_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">T_ext</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_surface_list</span><span class="p">)])</span>
        <span class="n">Q_il_str_A_iw</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Q_il_str_A_aw</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Q_il_kon_A</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Solar radiation</span>
        <span class="n">irradiances</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="n">hourly_data_irradiances</span>

        <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># Lists all surfaces to calculate the irradiance on each one and creates the solar gains</span>

        <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surface_list</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">surface</span><span class="o">.</span><span class="n">surface_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ExtWall&#39;</span><span class="p">,</span> <span class="s1">&#39;Roof&#39;</span><span class="p">]:</span>
                <span class="c1"># Some value loaded from surface and weather object</span>
                <span class="n">h_r</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">get_surface_external_radiative_coefficient</span><span class="p">()</span>
                <span class="n">alpha_str_a</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">rad_heat_trans_coef</span>
                <span class="n">alpha_a</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">_conv_heat_trans_coef_ext</span> <span class="o">+</span> <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">rad_heat_trans_coef</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">_sky_view_factor</span>
                <span class="n">F_sh_urban_shading</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">shading_coefficient</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="s2">&quot;shading_coefficient&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mf">1.</span>
                <span class="n">irradiance</span> <span class="o">=</span> <span class="n">irradiances</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">_azimuth_round</span><span class="p">)][</span><span class="nb">float</span><span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">_height_round</span><span class="p">)]</span>
                <span class="n">AOI</span> <span class="o">=</span> <span class="n">irradiance</span><span class="p">[</span><span class="s1">&#39;AOI&#39;</span><span class="p">]</span>
                <span class="n">BRV</span> <span class="o">=</span> <span class="n">irradiance</span><span class="p">[</span><span class="s1">&#39;direct&#39;</span><span class="p">]</span>
                <span class="n">TRV</span> <span class="o">=</span> <span class="n">irradiance</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span>
                <span class="c1"># Delta T long wave</span>
                <span class="n">delta_theta_eq_lw</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">theta_erd</span> <span class="o">-</span> <span class="n">T_ext</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span> <span class="o">+</span>
                                           <span class="p">(</span><span class="n">theta_atm</span> <span class="o">-</span> <span class="n">T_ext</span><span class="p">)</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">alpha_str_lw</span> <span class="o">*</span> <span class="mf">0.9</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.93</span> <span class="o">*</span> <span class="n">alpha_a</span><span class="p">)</span>
                <span class="n">delta_theta_eq_kw</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">BRV</span> <span class="o">*</span> <span class="n">F_sh_urban_shading</span> <span class="o">+</span> <span class="p">(</span><span class="n">TRV</span> <span class="o">-</span> <span class="n">BRV</span><span class="p">))</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">ext_absorptance</span> <span class="o">/</span> <span class="n">alpha_a</span>
                <span class="n">theta_eq</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">T_ext</span> <span class="o">+</span> <span class="n">delta_theta_eq_lw</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta_theta_eq_kw</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span> <span class="o">*</span> \
                                 <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">_u_value</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">UA_tot</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="s1">&#39;window&#39;</span><span class="p">):</span>
                    <span class="n">theta_eq_w</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">T_ext</span> <span class="o">+</span> <span class="n">delta_theta_eq_lw</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span> <span class="o">*</span> \
                                       <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">u_value</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">_glazed_area</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">UA_tot</span>
                    <span class="n">frame_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">_frame_factor</span>
                    <span class="n">F_sh</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">_shading_coef_ext</span>
                    <span class="n">F_w</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">_shading_coef_int</span>
                    <span class="n">F_sh_w</span> <span class="o">=</span> <span class="n">F_sh</span> <span class="o">*</span> <span class="n">F_w</span> <span class="o">*</span> <span class="n">F_sh_urban_shading</span>

                    <span class="n">shgc_rad</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splev</span><span class="p">(</span><span class="n">AOI</span><span class="p">,</span> <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">solar_heat_gain_coef_profile_rad</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">shgc_diffuse_rad</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splev</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">solar_heat_gain_coef_profile_rad</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">shgc_conv</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splev</span><span class="p">(</span><span class="n">AOI</span><span class="p">,</span> <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">solar_heat_gain_coef_profile_conv</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">shgc_diffuse_conv</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splev</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="n">surface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">solar_heat_gain_coef_profile_conv</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                    <span class="n">radiative_inward_solar_radiation</span> <span class="o">=</span> <span class="n">frame_factor</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">_glazed_area</span> <span class="o">*</span> <span class="p">(</span> <span class="n">shgc_rad</span> <span class="o">*</span> <span class="n">BRV</span> <span class="o">*</span> <span class="n">F_sh_w</span> <span class="o">+</span>
                                                                                        <span class="n">shgc_diffuse_rad</span> <span class="o">*</span> <span class="p">(</span><span class="n">TRV</span> <span class="o">-</span> <span class="n">BRV</span><span class="p">))</span>
                    <span class="n">convective_inward_solar_radiation</span> <span class="o">=</span> <span class="n">frame_factor</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">_glazed_area</span> <span class="o">*</span> <span class="p">(</span><span class="n">shgc_conv</span> <span class="o">*</span> <span class="n">BRV</span> <span class="o">*</span> <span class="n">F_sh_w</span> <span class="o">+</span>
                                                                                              <span class="n">shgc_diffuse_conv</span> <span class="o">*</span> <span class="p">(</span>
                                                                                                          <span class="n">TRV</span> <span class="o">-</span> <span class="n">BRV</span><span class="p">))</span>

                    <span class="c1"># Jacopo quì usa come A_v l&#39;area finestrata, mentre la norma parla di area finestrata + opaca per la direzione</span>
                    <span class="n">Q_il_str_A_iw</span> <span class="o">+=</span> <span class="n">radiative_inward_solar_radiation</span> <span class="o">*</span> <span class="p">(</span>
                                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Araum_tot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Aaw_tot</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Araum_tot</span> <span class="o">-</span> <span class="n">surface</span><span class="o">.</span><span class="n">_area</span><span class="p">))</span>
                    <span class="n">Q_il_str_A_aw</span> <span class="o">+=</span> <span class="n">radiative_inward_solar_radiation</span> <span class="o">*</span> <span class="p">(</span>
                                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Aaw_tot</span> <span class="o">-</span> <span class="n">surface</span><span class="o">.</span><span class="n">_area</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Araum_tot</span> <span class="o">-</span> <span class="n">surface</span><span class="o">.</span><span class="n">_area</span><span class="p">))</span>
                    <span class="n">Q_il_kon_A</span> <span class="o">+=</span> <span class="n">convective_inward_solar_radiation</span>

            <span class="k">if</span> <span class="n">surface</span><span class="o">.</span><span class="n">surface_type</span> <span class="o">==</span> <span class="s1">&#39;GroundFloor&#39;</span><span class="p">:</span>
                <span class="n">theta_eq</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">T_ext</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">_u_value</span> <span class="o">*</span> <span class="n">surface</span><span class="o">.</span><span class="n">_opaque_area</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">UA_tot</span>

        <span class="c1"># self.Q_il_str_A = self.Q_il_str_A.to_numpy()</span>
        <span class="c1"># self.carichi_sol = (Q_il_str_A_iw+ Q_il_str_A_aw).to_numpy()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">theta_eq_tot</span> <span class="o">=</span> <span class="n">theta_eq</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta_eq_w</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Calculates internal heat gains</span>
        <span class="n">phi_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_convective_radiative_latent_electric_load</span><span class="p">()</span>

        <span class="n">Q_il_str_I</span> <span class="o">=</span> <span class="n">phi_int</span><span class="p">[</span><span class="s1">&#39;radiative [W]&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q_il_kon_I</span> <span class="o">=</span> <span class="n">phi_int</span><span class="p">[</span><span class="s1">&#39;convective [W]&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">Q_il_kon_A</span>

        <span class="n">Q_il_str_I_iw</span> <span class="o">=</span> <span class="n">Q_il_str_I</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Araum_tot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Aaw_tot</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Araum_tot</span>
        <span class="n">Q_il_str_I_aw</span> <span class="o">=</span> <span class="n">Q_il_str_I</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Aaw_tot</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Araum_tot</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Q_il_str_iw</span> <span class="o">=</span> <span class="n">Q_il_str_A_iw</span> <span class="o">+</span> <span class="n">Q_il_str_I_iw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q_il_str_aw</span> <span class="o">=</span> <span class="n">Q_il_str_A_aw</span> <span class="o">+</span> <span class="n">Q_il_str_I_aw</span></div>


        <span class="c1"># sigma_fhk: fraction of radiant heating/cooling surfaces on total heating/cooling load</span>
        <span class="c1"># sigma_fhk_aw: fraction of radiant heating/cooling inside external walls on the total radiant heating/cooling load</span>
        <span class="c1"># sigma_hk_str: this is the radiant fraction the heating/cooling systems that are not embedded in the surfaces</span>
        <span class="c1">#</span>
        <span class="c1"># Let&#39;s say that a roof has 3 systems:</span>
        <span class="c1">#     1) a radiant internal ceiling (20% of the total load)</span>
        <span class="c1">#     2) a radiant floor (30% of the total load) in contact to the ground</span>
        <span class="c1">#     3) a radiator working 80% convective and 20% radiant (50% of the total load)</span>
        <span class="c1">#</span>
        <span class="c1"># sigma_fhk: 0.5</span>
        <span class="c1">#     sum of 20% for the radiant ceiling and 30% for the radiant floor</span>
        <span class="c1"># sigma_fhk_aw: 0.6</span>
        <span class="c1">#     because 0.3/(0.2+0.3) is equal to 0.6, i.e. the part of the radiant surface load</span>
        <span class="c1">#     associated to external surfaces</span>
        <span class="c1"># sigma_hk_str: 0.2</span>
        <span class="c1">#     because the radiator is radiative for the 20%</span>

        <span class="c1"># self.sigma = loadHK(sigma_fhk, sigma_fhk_aw, sigma_hk_str, self.Aaw, self.Araum)</span>

    <span class="c1"># def _plot_ISO13790_IHG(self):</span>
    <span class="c1">#     fig, ax = plt.subplots()</span>
    <span class="c1">#     pd.DataFrame({</span>
    <span class="c1">#         &#39;phi_ia&#39;: self.phi_ia,</span>
    <span class="c1">#         &#39;phi_st&#39;: self.phi_st,</span>
    <span class="c1">#         &#39;phi_m&#39;: self.phi_m</span>
    <span class="c1">#     }).plot(ax=ax)</span>

    <span class="c1"># def _plot_VDI6007_IHG(self, weather_file):</span>
    <span class="c1">#     fig, [ax1, ax2] = plt.subplots(nrows=2)</span>
    <span class="c1">#     pd.DataFrame({</span>
    <span class="c1">#         &#39;Q_il_kon_I&#39;: self.Q_il_kon_I,</span>
    <span class="c1">#         &#39;Q_il_str_iw&#39;: self.Q_il_str_iw,</span>
    <span class="c1">#         &#39;Q_il_str_aw&#39;: self.Q_il_str_aw</span>
    <span class="c1">#     }).plot(ax=ax1)</span>
    <span class="c1">#     pd.DataFrame({</span>
    <span class="c1">#         &#39;theta_eq_tot&#39;: self.theta_eq_tot,</span>
    <span class="c1">#         &#39;theta_ext&#39;: weather_file.hourly_data[&#39;out_air_db_temperature&#39;]</span>
    <span class="c1">#     }).plot(ax=ax2)</span>

<div class="viewcode-block" id="ThermalZone.sensible_balance_1C"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.sensible_balance_1C">[docs]</a>    <span class="k">def</span> <span class="nf">sensible_balance_1C</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">Hve</span><span class="p">,</span> <span class="n">T_e</span><span class="p">,</span> <span class="n">T_sup_AHU</span><span class="p">,</span> <span class="n">phi_load</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">T_set</span><span class="o">=</span><span class="mf">20.</span><span class="p">,</span> <span class="n">phi_HC_set</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Solves ISO 13790 network for a specific time step</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        flag : string</span>
<span class="sd">            flag to set the calculation method string &#39;Tset&#39; or &#39;phiset&#39;</span>
<span class="sd">        Hve : list</span>
<span class="sd">            list of two ositive floats. Ventilation and infiltration heat tranfer coeff [W/K]</span>
<span class="sd">            [Hve_vent, Hve_inf]</span>
<span class="sd">        T_e : float</span>
<span class="sd">            timestep external temperature [°C]</span>
<span class="sd">        T_sup_AHU : float</span>
<span class="sd">            timestep ventilation supply temperature [°C]</span>
<span class="sd">        phi_load : list</span>
<span class="sd">            list of three floats. The load on the three nodes network (ia, sm, m respectively) [W]</span>
<span class="sd">            [phi_ia, phi_sm, phi_m]</span>
<span class="sd">        sigma : list, default [0., 1.]</span>
<span class="sd">            list of 2 floats</span>
<span class="sd">            portion of the heating/cooling load to:</span>
<span class="sd">            sigma[0]: radiant to surface</span>
<span class="sd">            sigma[1]: convective to air node</span>
<span class="sd">            sum must be 1</span>
<span class="sd">        T_set : float, default 20.</span>
<span class="sd">            time step setpoint temperature [°C]</span>
<span class="sd">        phi_HC_set : float, default 0.</span>
<span class="sd">            time step thermal load to the ambient [W]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.array</span>
<span class="sd">            array with system load, air temperature, surfaces equivalent temperature and mass equivalent temperature</span>
<span class="sd">            e.g.</span>
<span class="sd">            [</span>
<span class="sd">            demand [W],</span>
<span class="sd">            T_air [°C],</span>
<span class="sd">            T_s [°C],</span>
<span class="sd">            T_m [°C]</span>
<span class="sd">            ]</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Check input data type</span>

        <span class="k">if</span> <span class="n">flag</span> <span class="o">!=</span> <span class="s1">&#39;Tset&#39;</span> <span class="ow">and</span> <span class="n">flag</span> <span class="o">!=</span> <span class="s1">&#39;phiset&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;ERROR Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, Sensible1C flag input is not a &#39;Tset&#39; or &#39;phiset&#39;: flag </span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Thermal Zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, Sensible1C: sigma total must be 1. Sigma = </span><span class="si">{</span><span class="n">sigma</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="c1"># Set some data and build up the system</span>

        <span class="n">phi_ia</span> <span class="o">=</span> <span class="n">phi_load</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">phi_st</span> <span class="o">=</span> <span class="n">phi_load</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">phi_m</span> <span class="o">=</span> <span class="n">phi_load</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">Hve_vent</span> <span class="o">=</span> <span class="n">Hve</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Hve_inf</span> <span class="o">=</span> <span class="n">Hve</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">time_step</span>
        <span class="n">rad_factor</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">conv_factor</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="s1">&#39;Tset&#39;</span><span class="p">:</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_factor</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_is</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">rad_factor</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Htr_is</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_w</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_ms</span><span class="p">)</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_ms</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_ms</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Cm</span> <span class="o">/</span> <span class="n">tau</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_em</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_ms</span>

            <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Hve_inf</span> <span class="o">*</span> <span class="p">(</span><span class="n">T_set</span> <span class="o">-</span> <span class="n">T_e</span><span class="p">)</span> <span class="o">+</span> <span class="n">Hve_vent</span> <span class="o">*</span> <span class="p">(</span><span class="n">T_set</span> <span class="o">-</span> <span class="n">T_sup_AHU</span><span class="p">)</span> <span class="o">-</span> <span class="n">phi_ia</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_is</span> <span class="o">*</span> <span class="n">T_set</span> \
                   <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_air_thermal_capacity</span> <span class="o">*</span> <span class="p">(</span><span class="n">T_set</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ta0</span><span class="p">)</span> <span class="o">/</span> <span class="n">tau</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Htr_is</span> <span class="o">*</span> <span class="n">T_set</span> <span class="o">-</span> <span class="n">phi_st</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_w</span> <span class="o">*</span> <span class="n">T_e</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Htr_em</span> <span class="o">*</span> <span class="n">T_e</span> <span class="o">-</span> <span class="n">phi_m</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cm</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tm0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">tau</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">T_set</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">flag</span> <span class="o">==</span> <span class="s1">&#39;phiset&#39;</span><span class="p">:</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Htr_is</span> <span class="o">+</span> <span class="n">Hve_inf</span> <span class="o">+</span> <span class="n">Hve_vent</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_air_thermal_capacity</span> <span class="o">/</span> <span class="n">tau</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_is</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_is</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Htr_is</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_w</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_ms</span><span class="p">)</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_ms</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_ms</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Cm</span> <span class="o">/</span> <span class="n">tau</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_em</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_ms</span>

            <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">phi_HC_set</span> <span class="o">*</span> <span class="n">conv_factor</span> <span class="o">-</span> <span class="n">Hve_inf</span> <span class="o">*</span> <span class="n">T_e</span> <span class="o">-</span> <span class="n">Hve_vent</span> <span class="o">*</span> <span class="n">T_sup_AHU</span> <span class="o">-</span> <span class="n">phi_ia</span> \
                   <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_air_thermal_capacity</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ta0</span> <span class="o">/</span> <span class="n">tau</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">phi_st</span> <span class="o">*</span> <span class="n">rad_factor</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_w</span> <span class="o">*</span> <span class="n">T_e</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Htr_em</span> <span class="o">*</span> <span class="n">T_e</span> <span class="o">-</span> <span class="n">phi_m</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cm</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tm0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">tau</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">phi_HC_set</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Energy system zone solution: flag must be &quot;phiset&quot; or &quot;Tset&quot;, flag: </span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThermalZone.sensible_balance_2C"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.sensible_balance_2C">[docs]</a>    <span class="k">def</span> <span class="nf">sensible_balance_2C</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">Hve</span><span class="p">,</span> <span class="n">T_e</span><span class="p">,</span> <span class="n">T_e_eq</span><span class="p">,</span> <span class="n">T_sup_AHU</span><span class="p">,</span> <span class="n">phi_load</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">T_set</span><span class="o">=</span><span class="mf">20.</span><span class="p">,</span>
                            <span class="n">phi_HC_set</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sensible2C solves the linear system (Y*x = q) of VDI6007 at each</span>
<span class="sd">        iteration with a given setpoint temperature or</span>
<span class="sd">        (*)Note: if  phi_HC &gt; 0 HEATING LOAD; phi_HC &lt; 0 COOLING LOAD.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        flag : string</span>
<span class="sd">            string &#39;Tset&#39; or &#39;phiset&#39;</span>
<span class="sd">        Hve : list</span>
<span class="sd">            list of two ositive floats. Ventilation and infiltration heat tranfer coeff [W/K]</span>
<span class="sd">            [Hve_vent, Hve_inf]</span>
<span class="sd">        T_e : float</span>
<span class="sd">            time step external temperature [°C]</span>
<span class="sd">        T_e_eq : float</span>
<span class="sd">            time step external equivalent temperature [°C]</span>
<span class="sd">        T_sup_AHU : float</span>
<span class="sd">            time step ventilation supply temperature [°C]</span>
<span class="sd">        phi_load : list</span>
<span class="sd">            list of three floats: internal and solar gains, three components (convective, aw and iw)[W]</span>
<span class="sd">            [phi_conv, phi_aw, phi_iw]</span>
<span class="sd">        sigma: list, default [0., 0., 1.]</span>
<span class="sd">            list of 3 floats</span>
<span class="sd">            portion of the heating cooling load to:</span>
<span class="sd">            sigma[0]: radiant to non adiabatic</span>
<span class="sd">            sigma[1]: radiant to adiabatic</span>
<span class="sd">            sigma[2]: convective to air node</span>
<span class="sd">            The sum must be 1</span>
<span class="sd">        T_set : float, default 20.</span>
<span class="sd">            time step setpoint of considered thermal zone [°C]</span>
<span class="sd">        phi_HC_set : float, default  0.</span>
<span class="sd">            time step Thermal load entering in the system [W]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.array</span>
<span class="sd">            temperature nodes of the RC model:</span>
<span class="sd">            theta_m_aw thermal mass of AW building components [°C]</span>
<span class="sd">            theta_s_aw surface of AW building components [°C]</span>
<span class="sd">            theta_lu_star No physical meaning (node obtained from the delta--&gt;star transformation) [°C]</span>
<span class="sd">            theta_I_lu internal air temperature [°C]  &lt;--- WHAT WE WILL EXTRACT AS OUTPUT outside the function</span>
<span class="sd">            Q_hk_ges heating/cooling load for maintaining the given setpoint temperature [W]  &lt;--- WHAT WE WILL EXTRACT AS OUTPUT outside the function</span>
<span class="sd">            theta_s_iw surface of IW building components [°C]</span>
<span class="sd">            theta_m_iw thermal mass of IW building components [°C]</span>
<span class="sd">            e.g.</span>
<span class="sd">            [</span>
<span class="sd">            theta_m_aw [°C],</span>
<span class="sd">            theta_s_aw [°C],</span>
<span class="sd">            theta_lu_star [°C],</span>
<span class="sd">            theta_I_lu [°C],</span>
<span class="sd">            Q_hk_ges [W]</span>
<span class="sd">            theta_s_iw [°C],</span>
<span class="sd">            theta_m_iw [°C],</span>
<span class="sd">            ]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check input data type</span>

        <span class="k">if</span> <span class="n">flag</span> <span class="o">!=</span> <span class="s1">&#39;Tset&#39;</span> <span class="ow">and</span> <span class="n">flag</span> <span class="o">!=</span> <span class="s1">&#39;phiset&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;ERROR Thermal zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, Sensible2C flag input is not a &#39;Tset&#39; or &#39;phiset&#39;: flag </span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Thermal Zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, Sensible1C: sigma total must be 1. Sigma = </span><span class="si">{</span><span class="n">sigma</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="c1"># % Resistances and capacitances of the 7R2C model</span>
        <span class="n">R_lue_ve</span> <span class="o">=</span> <span class="mf">1e20</span> <span class="k">if</span> <span class="n">Hve</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Hve</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">R_lue_inf</span> <span class="o">=</span> <span class="mf">1e20</span> <span class="k">if</span> <span class="n">Hve</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Hve</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">Q_il_kon</span> <span class="o">=</span> <span class="n">phi_load</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># convective heat gains (internal)</span>
        <span class="n">Q_il_str_aw</span> <span class="o">=</span> <span class="n">phi_load</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># radiant heat gains on surface node AW (internal + solar)</span>
        <span class="n">Q_il_str_iw</span> <span class="o">=</span> <span class="n">phi_load</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># radiant heat gains on surface node IW (internal + solar)</span>

        <span class="n">tau</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">time_step</span>

        <span class="n">theta_A_eq</span> <span class="o">=</span> <span class="n">T_e_eq</span>  <span class="c1"># equivalent outdoor temperature (sol-air temperature)</span>
        <span class="n">theta_lue</span> <span class="o">=</span> <span class="n">T_e</span>  <span class="c1"># outdoor air temperature</span>
        <span class="n">theta_sup</span> <span class="o">=</span> <span class="n">T_sup_AHU</span>

        <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="s1">&#39;Tset&#39;</span><span class="p">:</span>
            <span class="n">theta_I_lu</span> <span class="o">=</span> <span class="n">T_set</span>  <span class="c1"># internal air setpoint</span>

            <span class="c1"># MATRIX OF THERMAL TRANSMITTANCES</span>

            <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

            <span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RrestAW</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1AW</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1AW</span> <span class="o">/</span> <span class="n">tau</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1AW</span>

            <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1AW</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1AW</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarAW</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarAW</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">Y</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarAW</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarAW</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIL</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIW</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIW</span>

            <span class="n">Y</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIL</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="n">Y</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIW</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIW</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1IW</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1IW</span>

            <span class="n">Y</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1IW</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1IW</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1IW</span> <span class="o">/</span> <span class="n">tau</span>

            <span class="c1"># VECTOR OF KNOWN VALUES</span>

            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

            <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">theta_A_eq</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RrestAW</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1AW</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tm0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">tau</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Q_il_str_aw</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">theta_I_lu</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIL</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta_I_lu</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIL</span> <span class="o">-</span> <span class="n">Q_il_kon</span> \
                   <span class="o">-</span> <span class="p">(</span><span class="n">theta_lue</span> <span class="o">-</span> <span class="n">theta_I_lu</span><span class="p">)</span> <span class="o">/</span> <span class="n">R_lue_inf</span> \
                   <span class="o">-</span> <span class="p">(</span><span class="n">theta_sup</span> <span class="o">-</span> <span class="n">theta_I_lu</span><span class="p">)</span> <span class="o">/</span> <span class="n">R_lue_ve</span> \
                   <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_air_thermal_capacity</span> <span class="o">*</span> <span class="p">(</span><span class="n">theta_I_lu</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ta0</span><span class="p">)</span> <span class="o">/</span> <span class="n">tau</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Q_il_str_iw</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">C1IW</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tm0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">tau</span>

            <span class="c1"># OUTPUT (UNKNOWN) VARIABLES OF THE LINEAR SYSTEM</span>

            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">T_set</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">flag</span> <span class="o">==</span> <span class="s1">&#39;phiset&#39;</span><span class="p">:</span>
            <span class="c1"># Note: the heat load in input is already distributed on the 3 nodes</span>

            <span class="n">Q_hk_iw</span> <span class="o">=</span> <span class="n">phi_HC_set</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># % radiant heat flow from HVAC system (on surface node IW)</span>
            <span class="n">Q_hk_aw</span> <span class="o">=</span> <span class="n">phi_HC_set</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># % radiant heat flow from HVAC system (on surface node AW)</span>
            <span class="n">Q_hk_kon</span> <span class="o">=</span> <span class="n">phi_HC_set</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># % convective heat flow from HVAC system (on air node)</span>

            <span class="c1"># MATRIX OF THERMAL TRANSMITTANCES</span>

            <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

            <span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RrestAW</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1AW</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1AW</span> <span class="o">/</span> <span class="n">tau</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1AW</span>

            <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1AW</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1AW</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarAW</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarAW</span>

            <span class="n">Y</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarAW</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarAW</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIL</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIW</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIL</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIW</span>

            <span class="n">Y</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIL</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIL</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">R_lue_inf</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">R_lue_ve</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_air_thermal_capacity</span> <span class="o">/</span> <span class="n">tau</span>

            <span class="n">Y</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIW</span>

            <span class="n">Y</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RalphaStarIW</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1IW</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1IW</span>

            <span class="n">Y</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1IW</span>
            <span class="n">Y</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R1IW</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1IW</span> <span class="o">/</span> <span class="n">tau</span>

            <span class="c1"># VECTOR OF KNOWN TERMS</span>

            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">theta_A_eq</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RrestAW</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1AW</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tm0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">tau</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Q_hk_aw</span> <span class="o">-</span> <span class="n">Q_il_str_aw</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Q_hk_kon</span> <span class="o">-</span> <span class="n">Q_il_kon</span> <span class="o">-</span> <span class="n">theta_lue</span> <span class="o">/</span> <span class="n">R_lue_inf</span> <span class="o">-</span> <span class="n">theta_sup</span> <span class="o">/</span> <span class="n">R_lue_ve</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_air_thermal_capacity</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ta0</span> <span class="o">/</span> <span class="n">tau</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Q_hk_iw</span> <span class="o">-</span> <span class="n">Q_il_str_iw</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">C1IW</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tm0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">tau</span>

            <span class="c1"># OUTPUT LINEAR SYSTEM</span>

            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">phi_HC_set</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Energy system zone solution: flag must be &quot;phiset&quot; or &quot;Tset&quot;, flag: </span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThermalZone.latent_balance"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.latent_balance">[docs]</a>    <span class="k">def</span> <span class="nf">latent_balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">G_ve</span><span class="p">,</span> <span class="n">x_ext</span><span class="p">,</span> <span class="n">x_sup</span><span class="p">,</span> <span class="n">vapour_int_load</span><span class="p">,</span> <span class="n">t_air_int</span><span class="p">,</span> <span class="n">p_atm</span><span class="p">,</span> <span class="n">rh_int_set</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                       <span class="n">phi_HC_set</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Solves latent balance (vapour balance) for a specific time step</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        flag : str</span>
<span class="sd">             calculation mode&quot;phiset&quot; or &quot;rhset&quot;</span>
<span class="sd">        G_ve : list</span>
<span class="sd">            List of two floats: ventialtion and infiltration mass flow rate [kg/s]</span>
<span class="sd">            [G_ve_vent, G_ve_inf]</span>
<span class="sd">        x_ext : float</span>
<span class="sd">            time step external specific humidity [kg_vap/kg_da]</span>
<span class="sd">        x_sup : float</span>
<span class="sd">            time step supply specific humidity [kg_vap/kg_da]</span>
<span class="sd">        vapour_int_load : float</span>
<span class="sd">            time step vapour mass flow rate of internal loads [kg/s]</span>
<span class="sd">        t_air_int : float</span>
<span class="sd">            time step air temperature [°C]</span>
<span class="sd">        p_atm : float</span>
<span class="sd">            time step air temperature [°C]</span>
<span class="sd">        rh_int_set : float, default 0.5</span>
<span class="sd">            relative humidity set point [-]</span>
<span class="sd">        phi_HC_set : float, default 0.</span>
<span class="sd">            hvac latent load [W]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            array with zone specific humidity [kg_v, kg_as], zone relative humidity [-], latent demand [W]</span>
<span class="sd">            e.g.</span>
<span class="sd">            [</span>
<span class="sd">            zone specific humidity [kg_v, kg_as],</span>
<span class="sd">            zone relative humidity [-],</span>
<span class="sd">            latent demand [W],</span>
<span class="sd">            ]</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x_int_set</span><span class="p">,</span> <span class="n">p_intsat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_specific_humidity</span><span class="p">(</span><span class="n">t_air_int</span><span class="p">,</span> <span class="n">rh_int_set</span><span class="p">,</span> <span class="n">p_atm</span><span class="p">)</span>

        <span class="n">G_da_vent</span> <span class="o">=</span> <span class="n">G_ve</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">G_da_inf</span> <span class="o">=</span> <span class="n">G_ve</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">rho_air</span> <span class="o">=</span> <span class="n">air_properties</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span>
        <span class="n">vapour_lat_heat</span> <span class="o">=</span> <span class="n">vapour_properties</span><span class="p">[</span><span class="s1">&#39;latent_heat&#39;</span><span class="p">]</span>
        <span class="n">vapour_spec_heat</span> <span class="o">=</span> <span class="n">vapour_properties</span><span class="p">[</span><span class="s1">&#39;specific_heat&#39;</span><span class="p">]</span>

        <span class="n">tau</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">time_step</span>

        <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="s1">&#39;rhset&#39;</span><span class="p">:</span>
            <span class="n">phi_lat</span> <span class="o">=</span> <span class="p">(</span><span class="n">G_da_inf</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_ext</span> <span class="o">-</span> <span class="n">x_int_set</span><span class="p">)</span> <span class="o">+</span> <span class="n">G_da_vent</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">x_sup</span> <span class="o">-</span> <span class="n">x_int_set</span><span class="p">)</span> <span class="o">-</span> <span class="n">rho_air</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_int_set</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">xm0</span><span class="p">)</span> <span class="o">/</span> <span class="n">tau</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                              <span class="n">vapour_lat_heat</span> <span class="o">+</span> <span class="n">vapour_spec_heat</span> <span class="o">*</span> <span class="n">t_air_int</span><span class="p">)</span> <span class="o">+</span> <span class="n">vapour_int_load</span> <span class="o">*</span> <span class="p">(</span>
                              <span class="n">vapour_lat_heat</span> <span class="o">+</span> <span class="n">vapour_spec_heat</span> <span class="o">*</span> <span class="n">t_air_int</span><span class="p">)</span>
            <span class="n">x_int</span> <span class="o">=</span> <span class="n">x_int_set</span>
            <span class="n">phi_lat</span> <span class="o">=</span> <span class="o">-</span><span class="n">phi_lat</span>
        <span class="k">elif</span> <span class="n">flag</span> <span class="o">==</span> <span class="s1">&#39;phiset&#39;</span><span class="p">:</span>
            <span class="n">x_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">G_da_inf</span> <span class="o">*</span> <span class="n">x_ext</span> <span class="o">+</span> <span class="n">G_da_vent</span> <span class="o">*</span> <span class="n">x_sup</span> <span class="o">+</span> <span class="n">phi_HC_set</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">vapour_lat_heat</span> <span class="o">+</span> <span class="n">vapour_spec_heat</span> <span class="o">*</span> <span class="n">t_air_int</span><span class="p">)</span> <span class="o">+</span> <span class="n">vapour_int_load</span> <span class="o">+</span> <span class="n">rho_air</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xm0</span> <span class="o">/</span> <span class="n">tau</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                            <span class="n">G_da_inf</span> <span class="o">+</span> <span class="n">G_da_vent</span> <span class="o">+</span> <span class="n">rho_air</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume</span> <span class="o">/</span> <span class="n">tau</span><span class="p">)</span>
            <span class="n">phi_lat</span> <span class="o">=</span> <span class="n">phi_HC_set</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Humidity system zone solution: flag must be &quot;phiset&quot; or &quot;rhset&quot;, flag: </span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">p_int</span> <span class="o">=</span> <span class="n">p_atm</span> <span class="o">*</span> <span class="n">x_int</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.622</span> <span class="o">+</span> <span class="n">x_int</span><span class="p">)</span>
        <span class="n">RH_int</span> <span class="o">=</span> <span class="n">p_int</span> <span class="o">/</span> <span class="n">p_intsat</span>
        <span class="k">return</span> <span class="n">x_int</span><span class="p">,</span> <span class="n">RH_int</span><span class="p">,</span> <span class="n">phi_lat</span></div>

<div class="viewcode-block" id="ThermalZone.reset_init_values"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.reset_init_values">[docs]</a>    <span class="k">def</span> <span class="nf">reset_init_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="mf">15.</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0105</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;This method allows to reset temperatures starting values, for the first calculation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        T : float, default 15.</span>
<span class="sd">            Temperature to set as temperature mass [°C]</span>
<span class="sd">        X : float, default 0.0105</span>
<span class="sd">            Specific humidity [kg_v/kg_as]</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ta0</span> <span class="o">=</span> <span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tm0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xm0</span> <span class="o">=</span> <span class="n">X</span></div>

<div class="viewcode-block" id="ThermalZone.reset_init_values_VDI"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.reset_init_values_VDI">[docs]</a>    <span class="k">def</span> <span class="nf">reset_init_values_VDI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;This method allows to reset temperatures starting values, according to VDI tests</span>
<span class="sd">        Starting T 22 °C</span>
<span class="sd">        Starting x 0.0105 kg_v/kg_as</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ta0</span> <span class="o">=</span> <span class="mi">22</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tm0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xm0</span> <span class="o">=</span> <span class="mf">0.0105</span></div>

<div class="viewcode-block" id="ThermalZone.solve_timestep"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.solve_timestep">[docs]</a>    <span class="k">def</span> <span class="nf">solve_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">weather</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;2C&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Solves the thermal zone t - time step</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        t : int</span>
<span class="sd">            timestep of the simulation</span>
<span class="sd">        weather : eureca_building.weather.WeatherFile</span>
<span class="sd">            WeatherFile object</span>
<span class="sd">        model : str, default &quot;2C&quot;</span>
<span class="sd">            &#39;1C&#39; model or &#39;2C&#39; model</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Check input data type</span>

        <span class="k">if</span> <span class="n">model</span> <span class="o">!=</span> <span class="s1">&#39;1C&#39;</span> <span class="ow">and</span> <span class="n">model</span> <span class="o">!=</span> <span class="s1">&#39;2C&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Thermal Zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, time step </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">, model input is not a &#39;1C&#39; or &#39;2C&#39;: model </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">flag_AHU</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Weather data</span>
        <span class="n">T_ext</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="n">hourly_data</span><span class="p">[</span><span class="s1">&#39;out_air_db_temperature&#39;</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
        <span class="n">x_ext</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="n">hourly_data</span><span class="p">[</span><span class="s1">&#39;out_air_specific_humidity&#39;</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
        <span class="n">p_atm</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="n">hourly_data</span><span class="p">[</span><span class="s1">&#39;out_air_pressure&#39;</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>


        <span class="c1"># Internal Loads</span>
        <span class="n">G_IHG_vapour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latent_load</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>  <span class="c1"># kg_vap/s</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;1C&quot;</span><span class="p">:</span>
            <span class="n">phi_load</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_ia</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_st</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_m</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">T_ext_eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_eq_tot</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="n">phi_load</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Q_il_kon_I</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q_il_str_aw</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q_il_str_iw</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span>

        <span class="c1"># Natural Ventilation</span>

        <span class="n">G_OA_nat_vent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_air_flow_rate</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>  <span class="c1"># kg/s outdoor air</span>
        <span class="n">H_ve_nat_vent</span> <span class="o">=</span> <span class="n">G_OA_nat_vent</span> <span class="o">*</span> <span class="n">air_properties</span><span class="p">[</span><span class="s1">&#39;specific_heat&#39;</span><span class="p">]</span>  <span class="c1"># W/K</span>

        <span class="c1"># Ventilation</span>
        <span class="c1"># TODO: Air handler to more zone?</span>
        <span class="n">T_sup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_handling_unit</span><span class="o">.</span><span class="n">supply_temperature</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">x_sup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_handling_unit</span><span class="o">.</span><span class="n">supply_specific_humidity</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="c1"># for now the whole ahu flow rate to zone</span>
        <span class="n">G_OA_mec_vent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_handling_unit</span><span class="o">.</span><span class="n">air_flow_rate_kg_S</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="c1"># kg/s supply air</span>
        <span class="n">H_ve_mec_vent</span> <span class="o">=</span> <span class="n">G_OA_mec_vent</span> <span class="o">*</span> <span class="n">air_properties</span><span class="p">[</span><span class="s1">&#39;specific_heat&#39;</span><span class="p">]</span>  <span class="c1"># W/K</span>

        <span class="n">H_ve</span> <span class="o">=</span> <span class="p">[</span><span class="n">H_ve_mec_vent</span><span class="p">,</span> <span class="n">H_ve_nat_vent</span><span class="p">]</span>

        <span class="c1"># Set points</span>
        <span class="n">T_set_heat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_temperature_setpoint</span><span class="o">.</span><span class="n">schedule_lower</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">T_set_cool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_temperature_setpoint</span><span class="o">.</span><span class="n">schedule_upper</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">RH_set_int_H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_humidity_setpoint</span><span class="o">.</span><span class="n">schedule_lower</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">RH_set_int_C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_humidity_setpoint</span><span class="o">.</span><span class="n">schedule_upper</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

        <span class="c1"># Definition if the zone terminal is on or off for heating and cooling</span>
        <span class="n">zone_equipment_heating_mode</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">zone_equipment_cooling_mode</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">zone_humidity_equipment_heating_mode</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">zone_humidity_equipment_cooling_mode</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">P_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design_heating_system_power</span>
        <span class="n">P_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design_sensible_cooling_system_power</span>

        <span class="c1"># Start the zone system solution.. The logic depends on the heating cooling and latent sensible</span>

        <span class="k">while</span> <span class="n">flag_AHU</span><span class="p">:</span>

            <span class="c1"># SENSIBLE HEAT LOAD CALCULATION</span>

            <span class="c1"># First calc without plant (phi_HC_set = 0)</span>
            <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;1C&#39;</span><span class="p">:</span>
                <span class="n">pot</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">Ts</span><span class="p">,</span> <span class="n">Tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensible_balance_1C</span><span class="p">(</span>
                    <span class="s1">&#39;phiset&#39;</span><span class="p">,</span>
                    <span class="n">H_ve</span><span class="p">,</span>
                    <span class="n">T_ext</span><span class="p">,</span>
                    <span class="n">T_sup</span><span class="p">,</span>
                    <span class="n">phi_load</span><span class="p">,</span>
                    <span class="n">sigma</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span>
                    <span class="n">phi_HC_set</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;2C&#39;</span><span class="p">:</span>
                <span class="n">Tm_aw</span><span class="p">,</span> <span class="n">Ts_aw</span><span class="p">,</span> <span class="n">T_lu_star</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">pot</span><span class="p">,</span> <span class="n">Ts_iw</span><span class="p">,</span> <span class="n">Tm_iw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensible_balance_2C</span><span class="p">(</span>
                    <span class="s1">&#39;phiset&#39;</span><span class="p">,</span>
                    <span class="n">H_ve</span><span class="p">,</span>
                    <span class="n">T_ext</span><span class="p">,</span>
                    <span class="n">T_ext_eq</span><span class="p">,</span>
                    <span class="n">T_sup</span><span class="p">,</span>
                    <span class="n">phi_load</span><span class="p">,</span>
                    <span class="n">sigma</span><span class="o">=</span><span class="p">[</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span>
                    <span class="n">phi_HC_set</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

            <span class="c1"># Check if heating mode and heating calc</span>
            <span class="k">if</span> <span class="n">Ta</span> <span class="o">&lt;</span> <span class="n">T_set_heat</span> <span class="ow">and</span> <span class="n">zone_equipment_heating_mode</span><span class="p">:</span>
                <span class="c1"># This means that we are under setpoint and hetaing is active</span>
                <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;1C&#39;</span><span class="p">:</span>
                    <span class="n">pot</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">Ts</span><span class="p">,</span> <span class="n">Tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensible_balance_1C</span><span class="p">(</span>
                        <span class="s1">&#39;Tset&#39;</span><span class="p">,</span>
                        <span class="n">H_ve</span><span class="p">,</span>
                        <span class="n">T_ext</span><span class="p">,</span>
                        <span class="n">T_sup</span><span class="p">,</span>
                        <span class="n">phi_load</span><span class="p">,</span>
                        <span class="n">sigma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">heating_sigma</span><span class="p">[</span><span class="n">model</span><span class="p">],</span>
                        <span class="n">T_set</span><span class="o">=</span><span class="n">T_set_heat</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;2C&#39;</span><span class="p">:</span>
                    <span class="n">Tm_aw</span><span class="p">,</span> <span class="n">Ts_aw</span><span class="p">,</span> <span class="n">T_lu_star</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">pot</span><span class="p">,</span> <span class="n">Ts_iw</span><span class="p">,</span> <span class="n">Tm_iw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensible_balance_2C</span><span class="p">(</span>
                        <span class="s1">&#39;Tset&#39;</span><span class="p">,</span>
                        <span class="n">H_ve</span><span class="p">,</span>
                        <span class="n">T_ext</span><span class="p">,</span>
                        <span class="n">T_ext_eq</span><span class="p">,</span>
                        <span class="n">T_sup</span><span class="p">,</span>
                        <span class="n">phi_load</span><span class="p">,</span>
                        <span class="n">sigma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">heating_sigma</span><span class="p">[</span><span class="n">model</span><span class="p">],</span>
                        <span class="n">T_set</span><span class="o">=</span><span class="n">T_set_heat</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pot</span> <span class="o">&gt;</span> <span class="n">P_max</span><span class="p">:</span>
                    <span class="c1"># If the system reaches the maximum power</span>
                    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;1C&#39;</span><span class="p">:</span>
                        <span class="n">pot</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">Ts</span><span class="p">,</span> <span class="n">Tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensible_balance_1C</span><span class="p">(</span>
                            <span class="s1">&#39;phiset&#39;</span><span class="p">,</span>
                            <span class="n">H_ve</span><span class="p">,</span>
                            <span class="n">T_ext</span><span class="p">,</span>
                            <span class="n">T_sup</span><span class="p">,</span>
                            <span class="n">phi_load</span><span class="p">,</span>
                            <span class="n">sigma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">heating_sigma</span><span class="p">[</span><span class="n">model</span><span class="p">],</span>
                            <span class="n">phi_HC_set</span><span class="o">=</span><span class="n">P_max</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;2C&#39;</span><span class="p">:</span>
                        <span class="n">Tm_aw</span><span class="p">,</span> <span class="n">Ts_aw</span><span class="p">,</span> <span class="n">T_lu_star</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">pot</span><span class="p">,</span> <span class="n">Ts_iw</span><span class="p">,</span> <span class="n">Tm_iw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensible_balance_2C</span><span class="p">(</span>
                            <span class="s1">&#39;phiset&#39;</span><span class="p">,</span>
                            <span class="n">H_ve</span><span class="p">,</span>
                            <span class="n">T_ext</span><span class="p">,</span>
                            <span class="n">T_ext_eq</span><span class="p">,</span>
                            <span class="n">T_sup</span><span class="p">,</span>
                            <span class="n">phi_load</span><span class="p">,</span>
                            <span class="n">sigma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">heating_sigma</span><span class="p">[</span><span class="n">model</span><span class="p">],</span>
                            <span class="n">phi_HC_set</span><span class="o">=</span><span class="n">P_max</span><span class="p">)</span>

            <span class="c1"># Check if cooling mode and cooling calc</span>
            <span class="k">if</span> <span class="n">Ta</span> <span class="o">&gt;</span> <span class="n">T_set_cool</span> <span class="ow">and</span> <span class="n">zone_equipment_cooling_mode</span><span class="p">:</span>
                <span class="c1"># This means that we are over cooling setpoint and cooling is active</span>
                <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;1C&#39;</span><span class="p">:</span>
                    <span class="n">pot</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">Ts</span><span class="p">,</span> <span class="n">Tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensible_balance_1C</span><span class="p">(</span>
                        <span class="s1">&#39;Tset&#39;</span><span class="p">,</span>
                        <span class="n">H_ve</span><span class="p">,</span>
                        <span class="n">T_ext</span><span class="p">,</span>
                        <span class="n">T_sup</span><span class="p">,</span>
                        <span class="n">phi_load</span><span class="p">,</span>
                        <span class="n">sigma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cooling_sigma</span><span class="p">[</span><span class="n">model</span><span class="p">],</span>
                        <span class="n">T_set</span><span class="o">=</span><span class="n">T_set_cool</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;2C&#39;</span><span class="p">:</span>
                    <span class="n">Tm_aw</span><span class="p">,</span> <span class="n">Ts_aw</span><span class="p">,</span> <span class="n">T_lu_star</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">pot</span><span class="p">,</span> <span class="n">Ts_iw</span><span class="p">,</span> <span class="n">Tm_iw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensible_balance_2C</span><span class="p">(</span>
                        <span class="s1">&#39;Tset&#39;</span><span class="p">,</span>
                        <span class="n">H_ve</span><span class="p">,</span>
                        <span class="n">T_ext</span><span class="p">,</span>
                        <span class="n">T_ext_eq</span><span class="p">,</span>
                        <span class="n">T_sup</span><span class="p">,</span>
                        <span class="n">phi_load</span><span class="p">,</span>
                        <span class="n">sigma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cooling_sigma</span><span class="p">[</span><span class="n">model</span><span class="p">],</span>
                        <span class="n">T_set</span><span class="o">=</span><span class="n">T_set_cool</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pot</span> <span class="o">&lt;</span> <span class="n">P_min</span><span class="p">:</span>
                    <span class="c1"># If the system reaches the maximum cooling power</span>
                    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;1C&#39;</span><span class="p">:</span>
                        <span class="n">pot</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">Ts</span><span class="p">,</span> <span class="n">Tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensible_balance_1C</span><span class="p">(</span>
                            <span class="s1">&#39;phiset&#39;</span><span class="p">,</span>
                            <span class="n">H_ve</span><span class="p">,</span>
                            <span class="n">T_ext</span><span class="p">,</span>
                            <span class="n">T_sup</span><span class="p">,</span>
                            <span class="n">phi_load</span><span class="p">,</span>
                            <span class="n">sigma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cooling_sigma</span><span class="p">[</span><span class="n">model</span><span class="p">],</span>
                            <span class="n">phi_HC_set</span><span class="o">=</span><span class="n">P_min</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;2C&#39;</span><span class="p">:</span>
                        <span class="n">Tm_aw</span><span class="p">,</span> <span class="n">Ts_aw</span><span class="p">,</span> <span class="n">T_lu_star</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">pot</span><span class="p">,</span> <span class="n">Ts_iw</span><span class="p">,</span> <span class="n">Tm_iw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensible_balance_2C</span><span class="p">(</span>
                            <span class="s1">&#39;phiset&#39;</span><span class="p">,</span>
                            <span class="n">H_ve</span><span class="p">,</span>
                            <span class="n">T_ext</span><span class="p">,</span>
                            <span class="n">T_ext_eq</span><span class="p">,</span>
                            <span class="n">T_sup</span><span class="p">,</span>
                            <span class="n">phi_load</span><span class="p">,</span>
                            <span class="n">sigma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cooling_sigma</span><span class="p">[</span><span class="n">model</span><span class="p">],</span>
                            <span class="n">phi_HC_set</span><span class="o">=</span><span class="n">P_min</span><span class="p">)</span>

            <span class="c1"># LATENT HEAT LOAD CALCULATION</span>

            <span class="c1"># First calc without plant (phi_HC_set = 0)</span>
            <span class="n">x_int</span><span class="p">,</span> <span class="n">rh_int</span><span class="p">,</span> <span class="n">lat_pot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latent_balance</span><span class="p">(</span><span class="s1">&#39;phiset&#39;</span><span class="p">,</span>
                                                         <span class="p">[</span><span class="n">G_OA_mec_vent</span><span class="p">,</span> <span class="n">G_OA_nat_vent</span><span class="p">],</span>
                                                         <span class="n">x_ext</span><span class="p">,</span>
                                                         <span class="n">x_sup</span><span class="p">,</span>
                                                         <span class="n">G_IHG_vapour</span><span class="p">,</span>
                                                         <span class="n">Ta</span><span class="p">,</span>
                                                         <span class="n">p_atm</span><span class="p">,</span>
                                                         <span class="n">phi_HC_set</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

            <span class="c1"># Humidifying</span>
            <span class="k">if</span> <span class="n">rh_int</span> <span class="o">&lt;</span> <span class="n">RH_set_int_H</span> <span class="ow">and</span> <span class="n">zone_humidity_equipment_heating_mode</span><span class="p">:</span>
                <span class="n">x_int</span><span class="p">,</span> <span class="n">rh_int</span><span class="p">,</span> <span class="n">lat_pot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latent_balance</span><span class="p">(</span><span class="s1">&#39;rhset&#39;</span><span class="p">,</span>
                                                             <span class="p">[</span><span class="n">G_OA_mec_vent</span><span class="p">,</span> <span class="n">G_OA_nat_vent</span><span class="p">],</span>
                                                             <span class="n">x_ext</span><span class="p">,</span>
                                                             <span class="n">x_sup</span><span class="p">,</span>
                                                             <span class="n">G_IHG_vapour</span><span class="p">,</span>
                                                             <span class="n">Ta</span><span class="p">,</span>
                                                             <span class="n">p_atm</span><span class="p">,</span>
                                                             <span class="n">rh_int_set</span><span class="o">=</span><span class="n">RH_set_int_H</span><span class="p">,</span>
                                                             <span class="p">)</span>
                <span class="c1"># TODO: Check if a maximum value is reached</span>
            <span class="c1"># Dehumidifying</span>
            <span class="k">elif</span> <span class="n">rh_int</span> <span class="o">&gt;</span> <span class="n">RH_set_int_C</span> <span class="ow">and</span> <span class="n">zone_humidity_equipment_cooling_mode</span><span class="p">:</span>
                <span class="n">x_int</span><span class="p">,</span> <span class="n">rh_int</span><span class="p">,</span> <span class="n">lat_pot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latent_balance</span><span class="p">(</span><span class="s1">&#39;rhset&#39;</span><span class="p">,</span>
                                                             <span class="p">[</span><span class="n">G_OA_mec_vent</span><span class="p">,</span> <span class="n">G_OA_nat_vent</span><span class="p">],</span>
                                                             <span class="n">x_ext</span><span class="p">,</span>
                                                             <span class="n">x_sup</span><span class="p">,</span>
                                                             <span class="n">G_IHG_vapour</span><span class="p">,</span>
                                                             <span class="n">Ta</span><span class="p">,</span>
                                                             <span class="n">p_atm</span><span class="p">,</span>
                                                             <span class="n">rh_int_set</span><span class="o">=</span><span class="n">RH_set_int_C</span><span class="p">,</span>
                                                             <span class="p">)</span>
                <span class="c1"># TODO: Check if a maximum value is reached</span>

            <span class="c1"># Air Handling Unit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">air_handling_unit</span><span class="o">.</span><span class="n">air_handling_unit_calc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">weather</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">x_int</span><span class="p">)</span>
            <span class="n">err_T_sup</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">T_sup</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_handling_unit</span><span class="o">.</span><span class="n">T_sup</span><span class="p">)</span>
            <span class="n">err_x_sup</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_sup</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_handling_unit</span><span class="o">.</span><span class="n">x_sup</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">err_T_sup</span> <span class="o">&gt;</span> <span class="mf">0.1</span> <span class="ow">or</span> <span class="n">err_x_sup</span> <span class="o">&gt;</span> <span class="mf">0.0001</span><span class="p">:</span>
                <span class="c1">#case of t_sup or x_sup changed</span>
                <span class="n">T_sup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_handling_unit</span><span class="o">.</span><span class="n">T_sup</span>
                <span class="n">x_sup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_handling_unit</span><span class="o">.</span><span class="n">x_sup</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># UPDATE of dynamic variables</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">air_handling_unit</span><span class="o">.</span><span class="n">supply_temperature</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">T_sup</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">air_handling_unit</span><span class="o">.</span><span class="n">supply_specific_humidity</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_sup</span>
                <span class="n">heat_flow</span> <span class="o">=</span> <span class="n">pot</span>
                <span class="n">air_temp</span> <span class="o">=</span> <span class="n">Ta</span>
                <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;1C&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Tm0</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tm</span><span class="p">,</span> <span class="n">Tm</span><span class="p">]</span>  <span class="c1"># For 1C only 1 Tm</span>
                    <span class="n">operative_temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ts</span> <span class="o">+</span> <span class="n">Ta</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                    <span class="n">mean_radiant_temp</span> <span class="o">=</span> <span class="n">Ts</span>
                <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;2C&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Tm0</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tm_aw</span><span class="p">,</span> <span class="n">Tm_iw</span><span class="p">]</span>
                    <span class="n">operative_temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">Ts_aw</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Aaw_tot</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Araum_tot</span> <span class="o">+</span> <span class="n">Ts_iw</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">1</span><span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Aaw_tot</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Araum_tot</span><span class="p">))</span> <span class="o">+</span> <span class="n">Ta</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                    <span class="n">mean_radiant_temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ts_aw</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Aaw_tot</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Araum_tot</span> <span class="o">+</span> <span class="n">Ts_iw</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">1</span><span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Aaw_tot</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Araum_tot</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Ta0</span> <span class="o">=</span> <span class="n">Ta</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xm0</span> <span class="o">=</span> <span class="n">x_int</span>

                <span class="n">lat_heat_flow</span> <span class="o">=</span> <span class="n">lat_pot</span>
                <span class="n">air_spec_humidity</span> <span class="o">=</span> <span class="n">x_int</span>
                <span class="n">air_rel_humidity</span> <span class="o">=</span> <span class="n">rh_int</span>
                <span class="n">flag_AHU</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sensible_zone_load</span> <span class="o">=</span> <span class="n">pot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latent_zone_load</span> <span class="o">=</span> <span class="n">lat_heat_flow</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sensible_AHU_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_handling_unit</span><span class="o">.</span><span class="n">AHU_demand_sens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latent_AHU_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_handling_unit</span><span class="o">.</span><span class="n">AHU_demand_lat</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">zone_air_temperature</span> <span class="o">=</span> <span class="n">air_temp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zone_operative_temperature</span> <span class="o">=</span> <span class="n">operative_temp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zone_mean_radiant_temperature</span> <span class="o">=</span> <span class="n">mean_radiant_temp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zone_air_rel_humidity</span> <span class="o">=</span> <span class="n">air_rel_humidity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zone_air_spec_humidity</span> <span class="o">=</span> <span class="n">x_int</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">air_temp</span><span class="p">,</span><span class="n">operative_temp</span><span class="p">,</span><span class="n">mean_radiant_temp</span><span class="p">],</span> <span class="n">air_rel_humidity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tm0</span><span class="p">,</span> <span class="n">pot</span><span class="p">,</span> <span class="n">lat_heat_flow</span></div>

<div class="viewcode-block" id="ThermalZone.design_heating_load"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.design_heating_load">[docs]</a>    <span class="k">def</span> <span class="nf">design_heating_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_ext_design</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preliminary calculation to calculate the heating design temperature.</span>
<span class="sd">        Static calculation considering the product UA of all surfaces, the maximum infiltration flow rate, and the outdoor design temperature</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        t_ext_design : float</span>
<span class="sd">            outdoor design temperature [°C]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m_ve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_air_flow_rate</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">design_heating_system_power</span> <span class="o">=</span> <span class="mf">1.3</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Htr_op</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_w</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">20.</span> <span class="o">-</span> <span class="n">t_ext_design</span><span class="p">)</span> <span class="o">+</span> <span class="n">m_ve</span> <span class="o">*</span> <span class="n">air_properties</span><span class="p">[</span><span class="s1">&#39;specific_heat&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">20.</span> <span class="o">-</span> <span class="n">t_ext_design</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">design_heating_system_power</span></div>

<div class="viewcode-block" id="ThermalZone.design_sensible_cooling_load"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.design_sensible_cooling_load">[docs]</a>    <span class="k">def</span> <span class="nf">design_sensible_cooling_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weather</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;2C&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method calculates the peak cooling according to the thermal load and weather of the thermal zone</span>
<span class="sd">        In order to do this, checks the hottest day (outdoor air temperature for 1C model, equivalent temperature for 2C, including also solar loads)</span>
<span class="sd">        And runs a simulation of the two days in between this maximum (similar to Carrier method, but using the 1C or 2C method)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        weather : eureca_building.weather.WeatherFile</span>
<span class="sd">            WeatherFile object</span>
<span class="sd">        model : str, default &quot;2C&quot;</span>
<span class="sd">            &#39;1C&#39; model or &#39;2C&#39; model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_init_values</span><span class="p">(</span><span class="n">T</span> <span class="o">=</span> <span class="mf">27.</span><span class="p">)</span>
        <span class="c1"># Define point of max load</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;1C&quot;</span><span class="p">:</span>
            <span class="nb">max</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="n">hourly_data</span><span class="p">[</span><span class="s1">&#39;out_air_db_temperature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_eq_tot</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
        <span class="n">lim_air</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span> <span class="o">-</span> <span class="mi">24</span><span class="o">*</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">ts_per_hour</span><span class="p">,</span> <span class="nb">max</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">ts_per_hour</span><span class="p">]</span>
        <span class="n">sensible_max_cooling_load</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;1C&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lim_air</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">lim_air</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">pot</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">Ts</span><span class="p">,</span> <span class="n">Tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensible_balance_1C</span><span class="p">(</span><span class="s2">&quot;Tset&quot;</span><span class="p">,</span>
                                         <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_air_flow_rate</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">air_properties</span><span class="p">[</span><span class="s1">&#39;specific_heat&#39;</span><span class="p">]],</span>
                                         <span class="n">weather</span><span class="o">.</span><span class="n">hourly_data</span><span class="p">[</span><span class="s1">&#39;out_air_db_temperature&#39;</span><span class="p">][</span><span class="n">t</span><span class="p">],</span>
                                         <span class="mf">26.</span><span class="p">,</span>
                                         <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_ia</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_st</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_m</span><span class="p">[</span><span class="n">t</span><span class="p">]],</span>
                                         <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooling_sigma</span><span class="p">[</span><span class="s2">&quot;1C&quot;</span><span class="p">],</span>
                                         <span class="n">T_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_temperature_setpoint</span><span class="o">.</span><span class="n">schedule_upper</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                                         <span class="p">)</span>
                <span class="k">if</span> <span class="n">pot</span> <span class="o">&lt;</span> <span class="n">sensible_max_cooling_load</span><span class="p">:</span>
                    <span class="n">sensible_max_cooling_load</span> <span class="o">=</span> <span class="n">pot</span>

        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;2C&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lim_air</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">lim_air</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">Tm_aw</span><span class="p">,</span> <span class="n">Ts_aw</span><span class="p">,</span> <span class="n">T_lu_star</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">pot</span><span class="p">,</span> <span class="n">Ts_iw</span><span class="p">,</span> <span class="n">Tm_iw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensible_balance_2C</span><span class="p">(</span>
                    <span class="s1">&#39;Tset&#39;</span><span class="p">,</span>
                    <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_air_flow_rate</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">air_properties</span><span class="p">[</span><span class="s1">&#39;specific_heat&#39;</span><span class="p">]],</span>
                    <span class="n">weather</span><span class="o">.</span><span class="n">hourly_data</span><span class="p">[</span><span class="s1">&#39;out_air_db_temperature&#39;</span><span class="p">][</span><span class="n">t</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">theta_eq_tot</span><span class="p">[</span><span class="n">t</span><span class="p">],</span>
                    <span class="mf">26.</span><span class="p">,</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Q_il_kon_I</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q_il_str_aw</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q_il_str_iw</span><span class="p">[</span><span class="n">t</span><span class="p">]],</span>
                    <span class="n">sigma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cooling_sigma</span><span class="p">[</span><span class="s2">&quot;2C&quot;</span><span class="p">],</span>
                    <span class="n">T_set</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_temperature_setpoint</span><span class="o">.</span><span class="n">schedule_upper</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">pot</span> <span class="o">&lt;</span> <span class="n">sensible_max_cooling_load</span><span class="p">:</span>
                    <span class="n">sensible_max_cooling_load</span> <span class="o">=</span> <span class="n">pot</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">design_sensible_cooling_system_power</span> <span class="o">=</span> <span class="n">sensible_max_cooling_load</span> <span class="o">*</span> <span class="mf">1.2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_init_values</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">design_sensible_cooling_system_power</span></div>

<div class="viewcode-block" id="ThermalZone.get_zone_info"><a class="viewcode-back" href="../../eureca_building.html#eureca_building.thermal_zone.ThermalZone.get_zone_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_zone_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Just to print a beuty string of some info of the zone</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;Zone volume [m3]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume</span><span class="p">,</span>
            <span class="s2">&quot;Zone net floor area [m2]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_net_floor_area</span><span class="p">,</span>
            <span class="s1">&#39;Number of units [-]&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_units</span><span class="p">,</span>
            <span class="s2">&quot;Zone opaque heat transfer loss [W/K]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_op</span><span class="p">,</span>
            <span class="s2">&quot;Zone glazed heat transfer loss [W/K]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Htr_w</span><span class="p">,</span>
            <span class="s2">&quot;Zone design heating load [kW]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">design_heating_system_power</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span>
            <span class="s2">&quot;Zone design cooling load [kW]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">design_sensible_cooling_system_power</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span>
        <span class="p">}</span></div></div>


</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Enrico Prataviera, Jacopo Vivian.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>